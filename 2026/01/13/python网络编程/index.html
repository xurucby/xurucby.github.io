<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>python网络编程 | xuru的技术学习博客</title><meta name="author" content="xuru"><meta name="copyright" content="xuru"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="本文详细讲解python文件读写、网络编程">
<meta property="og:type" content="article">
<meta property="og:title" content="python网络编程">
<meta property="og:url" content="https://xurucby.github.io/2026/01/13/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html">
<meta property="og:site_name" content="xuru的技术学习博客">
<meta property="og:description" content="本文详细讲解python文件读写、网络编程">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xurucby.github.io/img/butterfly-icon.png">
<meta property="article:published_time" content="2026-01-13T03:32:08.000Z">
<meta property="article:modified_time" content="2026-01-13T03:37:14.839Z">
<meta property="article:author" content="xuru">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xurucby.github.io/img/butterfly-icon.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "python网络编程",
  "url": "https://xurucby.github.io/2026/01/13/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/",
  "image": "https://xurucby.github.io/img/butterfly-icon.png",
  "datePublished": "2026-01-13T03:32:08.000Z",
  "dateModified": "2026-01-13T03:37:14.839Z",
  "author": [
    {
      "@type": "Person",
      "name": "xuru",
      "url": "https://xurucby.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://xurucby.github.io/2026/01/13/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'python网络编程',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">xuru的技术学习博客</span></a><a class="nav-page-title" href="/"><span class="site-name">python网络编程</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"></div></nav><div id="post-info"><h1 class="post-title">python网络编程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2026-01-13T03:32:08.000Z" title="发表于 2026-01-13 11:32:08">2026-01-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2026-01-13T03:37:14.839Z" title="更新于 2026-01-13 11:37:14">2026-01-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/python/">python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="1-文件读写"><a href="#1-文件读写" class="headerlink" title="1. 文件读写"></a>1. 文件读写</h2><h3 id="1-1-引入"><a href="#1-1-引入" class="headerlink" title="1.1 引入"></a>1.1 引入</h3><ul>
<li><p>什么是文件</p>
<p>文件是保存在持久化存储设备(硬盘、U盘、光盘..)上的一段数据，一个文本，一个py文件，一张图片，视频音频等这些都是文件。</p>
</li>
<li><p>文件分类</p>
<ul>
<li>文本文件：打开后会自动解码为字符，如txt文件，word文件，py程序文件。</li>
<li>二进制文件：内部编码为二进制码，无法通过文字编码解析，如压缩包，音频，视频，图片等。</li>
</ul>
</li>
<li><p>字节串类型</p>
<ul>
<li><p>概念 ： 在python3中引入了字节串的概念，与str不同，字节串以字节序列值表达数据，更方便用来处理二进程数据。</p>
</li>
<li><p>字符串与字节串相互转化方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 普通的英文字符字符串常量可以在前面加b转换为字节串，例如：<span class="string">b&#x27;hello&#x27;</span></span><br><span class="line">- 变量或者包含非英文字符的字符串转换为字节串方法 ：<span class="built_in">str</span>.encode()</span><br><span class="line">- 字节串转换为字符串方法 : <span class="built_in">bytes</span>.decode() </span><br><span class="line"></span><br><span class="line">注意：python字符串用来表达utf8字符，因为并不是所有二进制内容都可以转化为utf8字符，所以不是所有字节串都能转化为字符串，但是所有字符串都能转化成二进制，所以所有字符串都能转换为字节串。</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="1-2-文件读写操作"><a href="#1-2-文件读写操作" class="headerlink" title="1.2 文件读写操作"></a>1.2 文件读写操作</h3><p>使用程序操作文件，无外乎对文件进行读或者写</p>
<ul>
<li>读 ：即从文件中获取内容</li>
<li>写 ：即修改文件中的内容</li>
</ul>
<p>对文件实现读写的基本操作步骤为：打开文件，读写文件，关闭文件。</p>
<h4 id="1-2-1-打开文件"><a href="#1-2-1-打开文件" class="headerlink" title="1.2.1 打开文件"></a>1.2.1 打开文件</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file_object = <span class="built_in">open</span>(file, mode=<span class="string">&#x27;r&#x27;</span>, buffering=-<span class="number">1</span>，encoding=<span class="literal">None</span>)</span><br><span class="line">功能：打开一个文件，返回一个文件对象。</span><br><span class="line">参数：file  文件名；</span><br><span class="line">     mode  打开文件的方式,如果不写默认为‘r’ </span><br><span class="line">     buffering  <span class="number">1</span>表示有行缓冲，默认则表示使用系统默认提供的缓冲机制。</span><br><span class="line">     encoding=<span class="string">&#x27;UTF-8&#x27;</span>  设置打开文件的编码方式，一般Linux下不需要</span><br><span class="line">返回值：成功返回文件操作对象。</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>打开模式</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>r</td>
<td>以读方式打开，文件必须存在</td>
</tr>
<tr>
<td>w</td>
<td>以写方式打开，文件不存在则创建，存在清空原有内容</td>
</tr>
<tr>
<td>a</td>
<td>以追加模式打开，文件不存在则创建，存在则继续进行写操作</td>
</tr>
<tr>
<td>r+</td>
<td>以读写模式打开 文件必须存在</td>
</tr>
<tr>
<td>w+</td>
<td>以读写模式打开文件，不存在则创建，存在清空原有内容</td>
</tr>
<tr>
<td>a+</td>
<td>追加并可读模式，文件不存在则创建，存在则继续进行写操作</td>
</tr>
<tr>
<td>rb</td>
<td>以二进制读模式打开 同r</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制写模式打开 同w</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制追加模式打开 同a</td>
</tr>
<tr>
<td>rb+</td>
<td>以二进制读写模式打开 同r+</td>
</tr>
<tr>
<td>wb+</td>
<td>以二进制读写模式打开 同w+</td>
</tr>
<tr>
<td>ab+</td>
<td>以二进制读写模式打开 同a+</td>
</tr>
</tbody></table>
<blockquote>
<p>注意 ：</p>
<ol>
<li>以二进制方式打开文件，读取内容为字节串，写入也需要写入字节串</li>
<li>无论什么文件都可以使用二进制方式打开，但是二进制文件则不能以文本方式打开，否则后续读写会报错。</li>
</ol>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">文件打开代码示例：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读方式打开文件</span></span><br><span class="line"><span class="comment"># file = open(&quot;3.txt&quot;,&quot;r&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写方法打开</span></span><br><span class="line"><span class="comment"># file = open(&quot;file.txt&quot;,&quot;w&quot;) # 清除原来内容</span></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>,<span class="string">&quot;a&quot;</span>) <span class="comment"># 不会清除原来内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭</span></span><br><span class="line">file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="1-2-2-读取文件"><a href="#1-2-2-读取文件" class="headerlink" title="1.2.2 读取文件"></a>1.2.2 读取文件</h4><ul>
<li>方法1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">read(size=-<span class="number">1</span>)</span><br><span class="line">功能： 来直接读取文件中字符。</span><br><span class="line">参数： 默认值为-<span class="number">1</span>，此时文件将被读取直至末尾，给定size表示最多读取给定个数字符（字节）。</span><br><span class="line">返回值： 返回读取到的内容</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：1. 文件过大时候不建议直接读取到文件结尾，占用内存较多，效率较低</p>
<p>​			2. 读到文件结尾如果继续进行读操作会返回空字符串。</p>
</blockquote>
<ul>
<li>方法2</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">readline(size=-<span class="number">1</span>)</span><br><span class="line">功能： 用来读取文件中一行</span><br><span class="line">参数： 默认值为-<span class="number">1</span>,表示读取一行，给定size表示最多读取指定的字符（字节）或到换行位置。</span><br><span class="line">返回值： 返回读取到的内容</span><br></pre></td></tr></table></figure>

<ul>
<li>方法3</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">readlines(hint=-<span class="number">1</span>)</span><br><span class="line">功能： 读取文件中的每一行作为列表中的一项</span><br><span class="line">参数： 默认值为-<span class="number">1</span>，文件将被读取直至末尾，给定hint表示读取到hint个字符所在行为止。</span><br><span class="line">返回值： 返回读取到的内容列表</span><br></pre></td></tr></table></figure>

<ul>
<li>方法4</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件对象本身也是一个可迭代对象，在for循环中可以迭代文件的每一行。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> fr:</span><br><span class="line">     <span class="built_in">print</span>(line)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">文件读操作代码示例：read_file.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开文件</span></span><br><span class="line"><span class="comment"># file = open(&quot;file.txt&quot;,&quot;r&quot;)</span></span><br><span class="line"></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取内容</span></span><br><span class="line">data = file.read()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每次读取一个字符,将文件内容原样打印出来</span></span><br><span class="line"><span class="comment"># while True:</span></span><br><span class="line"><span class="comment">#     data = file.read(1)</span></span><br><span class="line"><span class="comment">#     if data == &quot;&quot;:</span></span><br><span class="line"><span class="comment">#         break</span></span><br><span class="line"><span class="comment">#     print(data,end=&quot;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按行读取</span></span><br><span class="line"><span class="comment"># data = file.readline()</span></span><br><span class="line"><span class="comment"># print(data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取所有行内容</span></span><br><span class="line"><span class="comment"># data_list = file.readlines()</span></span><br><span class="line"><span class="comment"># print(data_list) # 内容列表</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 迭代每次获取一行</span></span><br><span class="line"><span class="comment"># for line in file:</span></span><br><span class="line"><span class="comment">#     print(line)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：基于 <span class="built_in">dict</span>.txt 完成</span><br><span class="line">编写一个函数,参数是一个单词,查询这个单词的解释</span><br><span class="line">提示 : 单词有可能查不到 <span class="literal">None</span>  Not Found</span><br><span class="line">      字符串切片   split()</span><br><span class="line">思路 : 使用 word 逐行比对</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_word</span>(<span class="params">word</span>):</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;dict.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    <span class="comment"># 每次读取一行</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        tmp = line.split(<span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>] <span class="comment"># 提取单词</span></span><br><span class="line">        <span class="comment"># 如果遍历的单词大于word就不用再找了</span></span><br><span class="line">        <span class="keyword">if</span> tmp &gt; word:</span><br><span class="line">            file.close()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">elif</span> word == tmp:</span><br><span class="line">            file.close()</span><br><span class="line">            <span class="keyword">return</span> line</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(find_word(<span class="string">&quot;abc&quot;</span>))</span><br></pre></td></tr></table></figure>



<h4 id="1-2-3-写入文件"><a href="#1-2-3-写入文件" class="headerlink" title="1.2.3 写入文件"></a>1.2.3 写入文件</h4><ul>
<li>方法1</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">write(data)</span><br><span class="line">功能: 把文本数据或二进制数据块的字符串写入到文件中去</span><br><span class="line">参数：要写入的内容</span><br><span class="line">返回值：写入的字符个数</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意： 如果需要换行要自己在写入内容中添加\n</p>
</blockquote>
<ul>
<li>方法2</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">writelines(str_list)</span><br><span class="line">功能：接受一个字符串列表作为参数，将它们写入文件。</span><br><span class="line">参数: 要写入的内容列表</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">文件写操作代码示例：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写打开</span></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="comment"># file = open(&quot;file.txt&quot;,&quot;a&quot;) # 追加</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写操作</span></span><br><span class="line"><span class="comment"># n = file.write(&quot;hello,死鬼\n&quot;.encode())</span></span><br><span class="line"><span class="comment"># file.write(&quot;哎呀,干啥\n&quot;.encode())</span></span><br><span class="line"><span class="comment"># print(&quot;写入字符数:&quot;,n)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将列表每一项写入到文件</span></span><br><span class="line">data = [</span><br><span class="line">    <span class="string">&quot;接着奏乐\n&quot;</span>,</span><br><span class="line">    <span class="string">&quot;接着舞\n&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">file.writelines(data)</span><br><span class="line"></span><br><span class="line">file.close()</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：编写一个函数,参数传入一个指定的文件,将这个文件</span><br><span class="line">复制到程序运行目录下,注意不确定文件类型</span><br><span class="line">思路 : 边读边写</span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将指定文件复制到这个文件夹下</span></span><br><span class="line"><span class="string">    :param filename: 指定的要复制的文件</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    new_file = filename.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>] <span class="comment"># 取出文件名</span></span><br><span class="line">    fr = <span class="built_in">open</span>(filename,<span class="string">&quot;rb&quot;</span>) <span class="comment"># 原文件</span></span><br><span class="line">    fw = <span class="built_in">open</span>(new_file,<span class="string">&quot;wb&quot;</span>) <span class="comment"># 新文件</span></span><br><span class="line">    <span class="comment"># 边读边写</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = fr.read(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fw.write(data)</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">copy(<span class="string">&quot;/home/tarena/b.jpg&quot;</span>)   </span><br></pre></td></tr></table></figure>



<h4 id="1-2-4-关闭文件"><a href="#1-2-4-关闭文件" class="headerlink" title="1.2.4 关闭文件"></a>1.2.4 关闭文件</h4><p>打开一个文件后我们就可以通过文件对象对文件进行操作了，当操作结束后可以关闭文件操作</p>
<ul>
<li>方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_object.close()</span><br></pre></td></tr></table></figure>

<ul>
<li>好处</li>
</ul>
<ol>
<li>可以销毁对象节省资源，（当然如果不关闭程序结束后对象也会被销毁）。</li>
<li>防止后面对这个对象的误操作。</li>
</ol>
<h4 id="1-2-5-with语句"><a href="#1-2-5-with语句" class="headerlink" title="1.2.5 with语句"></a>1.2.5 with语句</h4><p>python中的with语句也可以用于访问文件，在语句块结束后会自动释放资源。</p>
<ul>
<li>with语句格式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> context_expression [<span class="keyword">as</span> obj]:</span><br><span class="line">    <span class="keyword">with</span>-body</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>with访问文件</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;file&#x27;</span>,<span class="string">&#x27;r+&#x27;</span>) <span class="keyword">as</span> fr:</span><br><span class="line">    fr.read()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 ： with语句块结束后会自动释放f所以不再需要close().</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> 使用示例：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时打开文件简单使用 file = open()</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    data = file.read()</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 语句块结束 file 被销毁</span></span><br></pre></td></tr></table></figure>



<h4 id="1-2-6-读写缓冲区"><a href="#1-2-6-读写缓冲区" class="headerlink" title="1.2.6 读写缓冲区"></a>1.2.6 读写缓冲区</h4><ul>
<li><p>定义</p>
<p>系统自动的在内存中为每一个正在使用的文件开辟一个空间，在对文件读写时都是先将文件内容加载到缓冲区，再进行读写。</p>
<p><img src="/./img/buffer.jpg"></p>
</li>
<li><p>作用</p>
<ol>
<li>减少和磁盘的交互次数，保护磁盘。</li>
<li>提高了对文件的读写效率。</li>
</ol>
</li>
<li><p>缓冲区设置</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>设置方法</th>
<th>注意事项</th>
</tr>
</thead>
<tbody><tr>
<td>系统自定义</td>
<td>buffering&#x3D;-1</td>
<td></td>
</tr>
<tr>
<td>行缓冲</td>
<td>buffering&#x3D;1</td>
<td>当遇到\n时会刷新缓冲</td>
</tr>
<tr>
<td>指定缓冲区大小</td>
<td>buffering&gt;1</td>
<td>必须以二进制方式打开</td>
</tr>
</tbody></table>
</li>
<li><p>刷新缓冲区条件</p>
</li>
</ul>
<ol>
<li>缓冲区被写满</li>
<li>程序执行结束或者文件对象被关闭</li>
<li>程序中调用flush()函数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_obj.flush()</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">文件读写缓冲示例：buffer.py</span><br><span class="line"></span><br><span class="line"><span class="comment"># buffering=1 行缓冲</span></span><br><span class="line"><span class="comment"># file = open(&quot;file.txt&quot;,&quot;w&quot;,buffering=1)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># buffering &gt; 1 指定缓冲大小</span></span><br><span class="line">file = <span class="built_in">open</span>(<span class="string">&quot;file.txt&quot;</span>,<span class="string">&quot;wb&quot;</span>,buffering=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    data = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    file.write(data.encode())</span><br><span class="line">    <span class="comment"># file.flush() # 刷新缓冲</span></span><br><span class="line"></span><br><span class="line">file.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1-2-7-文件偏移量"><a href="#1-2-7-文件偏移量" class="headerlink" title="1.2.7 文件偏移量"></a>1.2.7 文件偏移量</h4><ul>
<li><p>定义</p>
<p>打开一个文件进行操作时系统会自动生成一个记录，记录每次读写操作时所处的文件位置，每次文件的读写操作都是从这个位置开始进行的。</p>
<blockquote>
<p>注意：</p>
<ol>
<li>r或者w方式打开，文件偏移量在文件开始位置</li>
<li>a方式打开，文件偏移量在文件结尾位置</li>
</ol>
</blockquote>
</li>
<li><p>文件偏移量控制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tell()</span><br><span class="line">功能：获取文件偏移量大小</span><br><span class="line">返回值：文件偏移量</span><br></pre></td></tr></table></figure>

 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">seek(offset[,whence])</span><br><span class="line">功能: 移动文件偏移量位置</span><br><span class="line">参数：offset  代表相对于某个位置移动的字节数。负数表示向前移动，正数表示向后移动。</span><br><span class="line">     whence是基准位置的默认值为 <span class="number">0</span>，代表从文件开头算起，<span class="number">1</span>代表从当前位置算起，<span class="number">2</span> 代表从文件  末尾算起。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：必须以二进制方式打开文件时，基准位置才能是1或者2</p>
</blockquote>
</li>
</ul>
<h3 id="1-3-os模块"><a href="#1-3-os模块" class="headerlink" title="1.3 os模块"></a>1.3 os模块</h3><p>os模块是Python标准库模块，包含了大量的文件处理函数。</p>
<ul>
<li>获取文件大小</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">os.path.getsize(file)</span><br><span class="line">功能： 获取文件大小</span><br><span class="line">参数： 指定文件</span><br><span class="line">返回值： 文件大小</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>查看文件列表</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">os.listdir(<span class="built_in">dir</span>)</span><br><span class="line">功能： 查看文件列表</span><br><span class="line">参数： 指定目录</span><br><span class="line">返回值：目录中的文件名列表</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>判断文件是否存在</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">os.path.exists(file)</span><br><span class="line">功能： 判断文件是否存在</span><br><span class="line">参数： 指定文件</span><br><span class="line">返回值： 布尔值</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">os模块使用示例：file.py</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;文件大小:&quot;</span>,os.path.getsize(<span class="string">&quot;file.txt&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;文件列表:&quot;</span>,os.listdir(<span class="string">&quot;.&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;文件是否存在:&quot;</span>,os.path.exists(<span class="string">&quot;file.txt&quot;</span>))</span><br></pre></td></tr></table></figure>



<h2 id="2-网络编程"><a href="#2-网络编程" class="headerlink" title="2. 网络编程"></a>2. 网络编程</h2><h3 id="2-1-网络基础认知"><a href="#2-1-网络基础认知" class="headerlink" title="2.1 网络基础认知"></a>2.1 网络基础认知</h3><h4 id="2-1-1-什么是网络"><a href="#2-1-1-什么是网络" class="headerlink" title="2.1.1 什么是网络"></a>2.1.1 什么是网络</h4><ul>
<li><p>什么是网络 : 计算机网络功能主要包括实现资源共享，实现数据信息的快速传递。</p>
<p><img src="/./img/1.jpg"></p>
<p><img src="/./img/2.png"></p>
</li>
</ul>
<h4 id="2-1-2-网络通信标准"><a href="#2-1-2-网络通信标准" class="headerlink" title="2.1.2 网络通信标准"></a>2.1.2 网络通信标准</h4><ul>
<li><p>面临问题</p>
<ol>
<li>不同的国家和公司都建立自己的通信标准不利于网络互连</li>
<li>多种标准并行情况下不利于技术的发展融合</li>
</ol>
<p><img src="/./img/4.jpg"></p>
</li>
<li><p>OSI模型 （Open System Interconnection Reference Model）</p>
<p><img src="/./img/5.jpg"></p>
<ul>
<li><p>好处</p>
<ol>
<li><p>建立了统一的通信标准</p>
</li>
<li><p>降低开发难度，每层功能明确，各司其职</p>
</li>
<li><p>七层模型实际规定了每一层的任务，该完成什么事情</p>
</li>
</ol>
</li>
</ul>
</li>
<li><p>TCP&#x2F;IP模型</p>
<ul>
<li>七层模型过于理想，结构细节太复杂</li>
<li>在工程中应用实践难度大</li>
<li>实际工作中以TCP&#x2F;IP模型为工作标准流程</li>
</ul>
<p><img src="/./img/6.jpg"></p>
</li>
<li><p>网络协议</p>
<ul>
<li><p>什么是网络协议：在网络数据传输中，都遵循的执行规则。</p>
</li>
<li><p>网络协议实际上规定了每一层在完成自己的任务时应该遵循什么规范。</p>
</li>
</ul>
</li>
<li><p>需要应用工程师做的工作 ： 编写应用工功能，明确对方地址，选择传输服务。</p>
<p>  <img src="/./img/7.jpg"></p>
</li>
</ul>
<h4 id="2-1-3-通信地址"><a href="#2-1-3-通信地址" class="headerlink" title="2.1.3  通信地址"></a>2.1.3  通信地址</h4><ul>
<li><p>IP地址</p>
<ul>
<li><p>IP地址 ： 即在网络中标识一台计算机的地址编号。</p>
</li>
<li><p>IP地址分类</p>
<ul>
<li>IPv4 ： 192.168.1.5 </li>
<li>IPv6 ：fe80::680a:76cf:ab11:2d73</li>
</ul>
</li>
<li><p>IPv4 特点</p>
<ul>
<li>分为4个部分，每部分是一个整数，取值分为0-255</li>
</ul>
</li>
<li><p>IPv6 特点</p>
<ul>
<li>分为8个部分，每部分4个16进制数，如果出现连续的数字 0 则可以用 :: 省略中间的0</li>
</ul>
</li>
<li><p>IP地址相关命令</p>
<ul>
<li><p>ifconfig : 查看Linux系统下计算机的IP地址</p>
<p><img src="/./img/7.png"></p>
</li>
<li><p>ping  [ip]：查看计算机的连通性 </p>
<p><img src="/./img/8.png"></p>
</li>
</ul>
</li>
<li><p>公网IP和内网IP</p>
<ul>
<li>公网IP指的是连接到互联网上的公共IP地址，大家都可以访问。（将来进公司，公司会申请公网IP作为网络项目的被访问地址）</li>
<li>内网IP指的是一个局域网络范围内由网络设备分配的保留IP地址。</li>
</ul>
</li>
</ul>
</li>
<li><p>端口号</p>
<ul>
<li><p>端口：网络地址的一部分，在一台计算机上，每个网络程序对应一个端口。</p>
<p><img src="/./img/3.png"></p>
</li>
<li><p>端口号特点</p>
<ul>
<li><p>取值范围： 0 —— 65535 的整数</p>
</li>
<li><p>一台计算机上的网络应用所使用的端口不会重复</p>
</li>
<li><p>通常 0——1023 的端口会被一些有名的程序或者系统服务占用，个人一般使用 &gt; 1024的端口</p>
</li>
<li><p>netstat   -nultp     显示当前系统中tcp和udp端口使用情况</p>
</li>
<li><p>lsof   -i  :[port]     显示一个端口是否被占用，需要管理员权限执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo  lsof  -i  :3306</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-1-4-服务端与客户端"><a href="#2-1-4-服务端与客户端" class="headerlink" title="2.1.4 服务端与客户端"></a>2.1.4 服务端与客户端</h4><ul>
<li><p>服务端（Server）：服务端是为客户端服务的，服务的内容诸如向客户端提供资源，保存客户端数据，处理客户端请求等。</p>
</li>
<li><p>客户端（Client） ：也称为用户端，是指与服务端相对应，为客户提供一定应用功能的程序，我们平时使用的手机或者电脑上的程序基本都是客户端程序。</p>
<p><img src="/./img/10.jpg"></p>
</li>
</ul>
<h3 id="2-2-UDP-传输方法"><a href="#2-2-UDP-传输方法" class="headerlink" title="2.2 UDP 传输方法"></a>2.2 UDP 传输方法</h3><h4 id="2-2-1-套接字简介"><a href="#2-2-1-套接字简介" class="headerlink" title="2.2.1 套接字简介"></a>2.2.1 套接字简介</h4><ul>
<li><p>套接字(Socket) ： 实现网络编程进行数据传输的一种技术手段,网络上各种各样的网络服务大多都是基于 Socket 来完成通信的。</p>
<p><img src="/./img/9.jpg"></p>
</li>
<li><p>Python套接字编程模块：import  socket</p>
</li>
</ul>
<h4 id="2-2-2-UDP套接字编程"><a href="#2-2-2-UDP套接字编程" class="headerlink" title="2.2.2  UDP套接字编程"></a>2.2.2  UDP套接字编程</h4><ul>
<li>创建套接字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sock=socket.socket(family,<span class="built_in">type</span>)</span><br><span class="line">功能：创建套接字</span><br><span class="line">参数：family  网络地址类型 AF_INET表示ipv4</span><br><span class="line">     <span class="built_in">type</span>  套接字类型 SOCK_DGRAM 表示udp套接字 （也叫数据报套接字） </span><br><span class="line">返回值： 套接字对象</span><br></pre></td></tr></table></figure>


<ul>
<li>绑定地址<ul>
<li>本地地址 ： ‘localhost’ , ‘127.0.0.1’</li>
<li>网络地址 ： ‘172.40.91.185’ （通过ifconfig查看）</li>
<li>自动获取地址： ‘0.0.0.0’</li>
</ul>
</li>
</ul>
<p><img src="/img/address.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.bind(addr)</span><br><span class="line">功能： 绑定本机网络地址</span><br><span class="line">参数： 二元元组 (ip,port)  (<span class="string">&#x27;0.0.0.0&#x27;</span>,<span class="number">8888</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>消息收发</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">data,addr = sock.recvfrom(buffersize)</span><br><span class="line">功能： 接收UDP消息</span><br><span class="line">参数： 每次最多接收多少字节</span><br><span class="line">返回值： data  接收到的内容</span><br><span class="line">        addr  消息发送方地址</span><br><span class="line"></span><br><span class="line">n = sock.sendto(data,addr)</span><br><span class="line">功能： 发送UDP消息</span><br><span class="line">参数： data  发送的内容 <span class="built_in">bytes</span>格式</span><br><span class="line">      addr  目标地址</span><br><span class="line">返回值：发送的字节数</span><br></pre></td></tr></table></figure>

<ul>
<li>关闭套接字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sock.close()</span><br><span class="line">功能：关闭套接字</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">UDP服务端代码示例：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket import <span class="operator">*</span></span><br><span class="line"></span><br><span class="line"># 创建UDP套接字</span><br><span class="line">udp_socket <span class="operator">=</span> socket(AF_INET,SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">#  绑定地址</span><br><span class="line">udp_socket.bind((&quot;0.0.0.0&quot;,<span class="number">8888</span>))</span><br><span class="line"></span><br><span class="line">while <span class="literal">True</span>:</span><br><span class="line">    # 接收发送消息  data<span class="comment">--&gt; bytes</span></span><br><span class="line">    data,addr <span class="operator">=</span> udp_socket.recvfrom(<span class="number">5</span>)</span><br><span class="line">    # if data <span class="operator">=</span><span class="operator">=</span> b&quot;##&quot;:</span><br><span class="line">    #     break</span><br><span class="line">    print(&quot;从&quot;,addr,&quot;收到:&quot;,data.decode())</span><br><span class="line"></span><br><span class="line">    # 发送给刚才收到的地址</span><br><span class="line">    udp_socket.sendto(b&quot;Thanks&quot;,addr)</span><br><span class="line"></span><br><span class="line"># 关闭套接字</span><br><span class="line">udp_socket.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">UDP 客户端代码示例：</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">udp_client.py</span></span><br><span class="line"><span class="string">udp 客户端示例</span></span><br><span class="line"><span class="string">重点代码！！</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址</span></span><br><span class="line">ADDR = (<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 与服务端相同套接字</span></span><br><span class="line">udp_socket = socket(AF_INET,SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送消息</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    udp_socket.sendto(msg.encode(),ADDR)</span><br><span class="line">    <span class="comment"># 结束发送</span></span><br><span class="line">    <span class="comment"># if msg == &quot;##&quot;:</span></span><br><span class="line">    <span class="comment">#     break</span></span><br><span class="line"></span><br><span class="line">    data,addr = udp_socket.recvfrom(<span class="number">128</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;从服务端收到:&quot;</span>,data.decode())</span><br><span class="line"></span><br><span class="line">udp_socket.close()</span><br></pre></td></tr></table></figure>



<ul>
<li><p>服务端客户端流程</p>
<p><img src="/./img/11.png"></p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line"></span><br><span class="line">使用udp完成网络单词查询</span><br><span class="line">从客户端输入单词，发送给服务端，从服务端得到单词的解释，打印出来</span><br><span class="line"><span class="comment">########################## 服务端 ###############################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逻辑处理 网络搭建</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryWord</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        <span class="variable language_">self</span>.sock = <span class="variable language_">self</span>.create_socket()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_socket</span>(<span class="params">self</span>):</span><br><span class="line">        sock = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">        sock.bind((<span class="variable language_">self</span>.host, <span class="variable language_">self</span>.port))</span><br><span class="line">        <span class="keyword">return</span> sock</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.close()</span><br><span class="line">	</span><br><span class="line">  	</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_mean</span>(<span class="params">self,word</span>):</span><br><span class="line">        file = <span class="built_in">open</span>(<span class="string">&quot;dict.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">        <span class="comment"># 每次读取一行</span></span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            tmp = line.split(<span class="string">&#x27; &#x27;</span>,<span class="number">1</span>) </span><br><span class="line">            <span class="comment"># 如果遍历的单词大于word就不用再找了</span></span><br><span class="line">            <span class="keyword">if</span> tmp[<span class="number">0</span>] &gt; word:</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> word == tmp:</span><br><span class="line">                file.close()</span><br><span class="line">                <span class="keyword">return</span> tmp[<span class="number">1</span>].strip()</span><br><span class="line">    		<span class="keyword">return</span> <span class="string">&quot;Not Found&quot;</span></span><br><span class="line">      </span><br><span class="line">    <span class="comment"># 查找单词方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_word</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            word, addr = <span class="variable language_">self</span>.sock.recvfrom(<span class="number">128</span>)</span><br><span class="line">            <span class="comment"># 查询单词</span></span><br><span class="line">            mean = <span class="variable language_">self</span>.get_mean(word.decode())</span><br><span class="line"></span><br><span class="line">            <span class="variable language_">self</span>.sock.sendto(mean.encode(), addr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    query = QueryWord()</span><br><span class="line">    query.query_word()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">############################ 客户端代码#########################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址</span></span><br><span class="line">ADDR = (<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryWord</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock = socket(<span class="built_in">type</span>=SOCK_DGRAM)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">close</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.close()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 网络传输</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">recv_mean</span>(<span class="params">self,word</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.sendto(word.encode(),ADDR)</span><br><span class="line">        mean,addr = <span class="variable language_">self</span>.sock.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> mean.decode()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 输入输出</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query_word</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            word = <span class="built_in">input</span>(<span class="string">&quot;Word:&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> word:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            mean = <span class="variable language_">self</span>.recv_mean(word)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;%s : %s&quot;</span>%(word,mean))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    query = QueryWord()</span><br><span class="line">    query.query_word() <span class="comment"># 查单词</span></span><br><span class="line">    query.close()</span><br></pre></td></tr></table></figure>



<h4 id="2-2-3-UDP套接字特点"><a href="#2-2-3-UDP套接字特点" class="headerlink" title="2.2.3  UDP套接字特点"></a>2.2.3  UDP套接字特点</h4><ul>
<li>可能会出现数据丢失的情况</li>
<li>传输过程简单，实现容易</li>
<li>数据以数据包形式表达传输</li>
<li>数据传输效率较高</li>
</ul>
<h3 id="2-3-TCP-传输方法"><a href="#2-3-TCP-传输方法" class="headerlink" title="2.3 TCP 传输方法"></a>2.3 TCP 传输方法</h3><h4 id="2-3-1-TCP传输特点"><a href="#2-3-1-TCP传输特点" class="headerlink" title="2.3.1 TCP传输特点"></a>2.3.1 TCP传输特点</h4><ul>
<li><p>面向连接的传输服务</p>
<ul>
<li>传输特征 ： 提供了可靠的数据传输，可靠性指数据传输过程中无丢失，无失序，无差错，无重复。</li>
<li>可靠性保障机制（都是操作系统网络服务自动帮应用完成的）： <ul>
<li>在通信前需要建立数据连接</li>
<li>确认应答机制</li>
<li>通信结束要正常断开连接</li>
</ul>
</li>
</ul>
</li>
<li><p>三次握手（建立连接）</p>
<ul>
<li>客户端向服务器发送消息报文请求连接</li>
<li>服务器收到请求后，回复报文确定可以连接</li>
<li>客户端收到回复，发送最终报文连接建立</li>
</ul>
</li>
</ul>
<p><img src="/./img/tcp_three.png"></p>
<ul>
<li>四次挥手（断开连接）<ul>
<li>主动方发送报文请求断开连接</li>
<li>被动方收到请求后，立即回复，表示准备断开</li>
<li>被动方准备就绪，再次发送报文表示可以断开</li>
<li>主动方收到确定，发送最终报文完成断开</li>
</ul>
</li>
</ul>
<p><img src="/./img/tcp_four.png"></p>
<h4 id="2-3-2-TCP服务端"><a href="#2-3-2-TCP服务端" class="headerlink" title="2.3.2 TCP服务端"></a>2.3.2 TCP服务端</h4><p><img src="/./img/1_TCP_Server.png"></p>
<ul>
<li>创建套接字</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sock=socket.socket(family,<span class="built_in">type</span>)</span><br><span class="line">功能：创建套接字</span><br><span class="line">参数：family  网络地址类型 AF_INET表示ipv4</span><br><span class="line">     <span class="built_in">type</span>  套接字类型 SOCK_STREAM 表示tcp套接字 （也叫流式套接字） </span><br><span class="line">    返回值： 套接字对象</span><br></pre></td></tr></table></figure>

<ul>
<li>绑定地址 （与udp套接字相同）</li>
</ul>
<ul>
<li>设置监听</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.listen(n)</span><br><span class="line">功能 ： 将套接字设置为监听套接字，确定监听队列大小</span><br><span class="line">参数 ： 监听队列大小</span><br></pre></td></tr></table></figure>

<p><img src="/./img/11.jpg"></p>
<ul>
<li>处理客户端连接请求</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">conn,addr = sock.accept()</span><br><span class="line">功能： 阻塞等待处理客户端请求</span><br><span class="line">返回值： conn  客户端连接套接字</span><br><span class="line">        addr  连接的客户端地址</span><br></pre></td></tr></table></figure>

<ul>
<li>消息收发</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data = conn.recv(buffersize)</span><br><span class="line">功能 : 接受客户端消息</span><br><span class="line">参数 ：每次最多接收消息的大小</span><br><span class="line">返回值： 接收到的内容</span><br><span class="line"></span><br><span class="line">n = conn.send(data)</span><br><span class="line">功能 : 发送消息</span><br><span class="line">参数 ：要发送的内容  <span class="built_in">bytes</span>格式</span><br><span class="line">返回值： 发送的字节数</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>关闭套接字 (与udp套接字相同)</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">TCP服务端示例01：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建tcp套接字</span></span><br><span class="line">tcp_socket = socket(AF_INET,SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定地址</span></span><br><span class="line">tcp_socket.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8888</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为监听套接字</span></span><br><span class="line">tcp_socket.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待客户端连接</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Waiting for connect...&quot;</span>)</span><br><span class="line">    connfd,addr = tcp_socket.accept()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>,addr)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 循环收发消息  客户端退出 recv立即返回b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = connfd.recv(<span class="number">5</span>)</span><br><span class="line">        <span class="comment"># data=b&quot;&quot;客户端直接关闭  b&quot;##&quot;客户端主动告知关闭</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> data == <span class="string">b&#x27;##&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;收到:&quot;</span>,data.decode())</span><br><span class="line">        connfd.send(<span class="string">b&quot;Thanks/&quot;</span>)</span><br><span class="line">    connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭套接字</span></span><br><span class="line">tcp_socket.close()</span><br></pre></td></tr></table></figure>



<h4 id="2-3-3-TCP客户端"><a href="#2-3-3-TCP客户端" class="headerlink" title="2.3.3 TCP客户端"></a>2.3.3 TCP客户端</h4><p><img src="/./img/1_TCP_Client.png"></p>
<ul>
<li>创建TCP套接字</li>
<li>请求连接</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sock.connect(server_addr)</span><br><span class="line">功能：连接服务器</span><br><span class="line">参数：元组  服务器地址</span><br></pre></td></tr></table></figure>

<ul>
<li>收发消息</li>
</ul>
<blockquote>
<p>注意： 防止两端都阻塞，recv send要配合</p>
</blockquote>
<ul>
<li><p>关闭套接字</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">TCP客户端示例01：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端地址</span></span><br><span class="line">ADDR = (<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用默认值--》tcp</span></span><br><span class="line">tcp_socket = socket()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发起连接</span></span><br><span class="line">tcp_socket.connect(ADDR)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环发送接收消息</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    tcp_socket.send(msg.encode())</span><br><span class="line">    <span class="comment"># 结束发送</span></span><br><span class="line">    <span class="keyword">if</span> msg == <span class="string">&quot;##&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    data = tcp_socket.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;From server:&quot;</span>,data.decode())</span><br><span class="line"></span><br><span class="line">tcp_socket.close()</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/./img/12.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line"></span><br><span class="line">1. 编写一个程序，统计客户端的连接个数</span><br></pre></td></tr></table></figure>





<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">在客户端将一张图片上传到服务端，图片自选，上传到服务端后命名为 recv.jpg</span><br><span class="line"></span><br><span class="line">思路： 客户端   获取文件内容--》发送出去</span><br><span class="line">      服务端   接收文件内容--》写入磁盘</span><br><span class="line">    </span><br><span class="line"><span class="comment">########################## 服务端部分 #####################</span></span><br><span class="line"><span class="keyword">from</span>  socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收内容，写入文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_file</span>(<span class="params">connfd</span>):</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;recv.jpg&quot;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    <span class="comment"># 边收边写</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = connfd.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">b&quot;##&quot;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        file.write(data)</span><br><span class="line">    file.close()</span><br><span class="line">    connfd.send(<span class="string">&quot;上传完毕&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 创建tcp套接字</span></span><br><span class="line">    tcp_socket = socket()</span><br><span class="line">    tcp_socket.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    tcp_socket.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        connfd,addr = tcp_socket.accept()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>,addr)</span><br><span class="line">        <span class="comment"># 接收文件</span></span><br><span class="line">        recv_file(connfd)</span><br><span class="line">        connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line">    </span><br><span class="line"><span class="comment">############################ 客户端部分 ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_file</span>(<span class="params">tcp_socket,filename</span>):</span><br><span class="line">    file = <span class="built_in">open</span>(filename,<span class="string">&quot;rb&quot;</span>)</span><br><span class="line">    <span class="comment"># 边读边发送</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = file.read(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        tcp_socket.send(data)</span><br><span class="line">    file.close()</span><br><span class="line">    tcp_socket.send(<span class="string">b&quot;##&quot;</span>) <span class="comment"># 告知服务端结束</span></span><br><span class="line">    msg = tcp_socket.recv(<span class="number">128</span>)</span><br><span class="line">    <span class="built_in">print</span>(msg.decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">filename</span>):</span><br><span class="line">    tcp_socket = socket()</span><br><span class="line">    tcp_socket.connect((<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    <span class="comment"># 发送文件</span></span><br><span class="line">    send_file(tcp_socket,filename)</span><br><span class="line">    tcp_socket.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(<span class="string">&quot;./zly.jfif&quot;</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">TCP服务端示例02：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建tcp套接字</span></span><br><span class="line">tcp_socket = socket(AF_INET,SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绑定地址</span></span><br><span class="line">tcp_socket.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8888</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为监听套接字</span></span><br><span class="line">tcp_socket.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环连接 收发 断开 -》 每次发送消息都需要连接</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    connfd,addr = tcp_socket.accept()</span><br><span class="line"></span><br><span class="line">    data = connfd.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;收到:&quot;</span>,data.decode())</span><br><span class="line">    connfd.send(<span class="string">b&quot;Thanks&quot;</span>)</span><br><span class="line">    connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭套接字</span></span><br><span class="line">tcp_socket.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">TCP客户端示例02：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端地址</span></span><br><span class="line">ADDR = (<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8880</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环发送接收消息</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    msg = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    tcp_socket = socket()</span><br><span class="line">    tcp_socket.connect(ADDR)</span><br><span class="line">    tcp_socket.send(msg.encode())</span><br><span class="line">    data = tcp_socket.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;From server:&quot;</span>,data.decode())</span><br><span class="line">    tcp_socket.close()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">随堂练习 ：</span><br><span class="line">编写一个用户点餐小程序，客户端启动后能够看到餐厅点餐系统菜单，用户选择完毕后选择下单，此时后台需要记录哪一个桌位，点了什么菜品，点了几份。可自行设计数据模型。完成这个系统的简易表达</span><br></pre></td></tr></table></figure>



<h4 id="2-3-4-TCP套接字细节"><a href="#2-3-4-TCP套接字细节" class="headerlink" title="2.3.4 TCP套接字细节"></a>2.3.4 TCP套接字细节</h4><ul>
<li><p>tcp连接中当一端退出，另一端如果阻塞在recv，此时recv会立即返回一个空字串。</p>
</li>
<li><p>tcp连接中如果一端已经不存在，仍然试图通过send向其发送数据则会产生BrokenPipeError</p>
</li>
<li><p>一个服务端可以同时连接多个客户端，也能够重复被连接</p>
</li>
<li><p>tcp粘包问题</p>
<ul>
<li><p>产生原因</p>
<ul>
<li>为了解决数据再传输过程中可能产生的速度不协调问题，操作系统设置了缓冲区</li>
<li>实际网络工作过程比较复杂，导致消息收发速度不一致</li>
<li>tcp以字节流方式进行数据传输，在接收时不区分消息边界</li>
</ul>
<p><img src="/./img/13.jpg"></p>
</li>
<li><p>带来的影响</p>
<ul>
<li>如果每次发送内容是一个独立的含义，需要接收端独立解析此时粘包会有影响。</li>
</ul>
</li>
<li><p>处理方法</p>
<ul>
<li>消息格式化处理，如人为的添加消息边界，用作消息之间的分割</li>
<li>控制发送的速度</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">在客户端有一些数据</span><br><span class="line">data = [</span><br><span class="line">  <span class="string">&quot;张三  18   177&quot;</span>,</span><br><span class="line">  <span class="string">&quot;李四  19   180&quot;</span>,</span><br><span class="line">  <span class="string">&quot;王五  120  183&quot;</span></span><br><span class="line">]</span><br><span class="line">从客户端向服务端发送这些数据，在服务端将这些数据分别写入到一个文件中，每个数据占一行</span><br><span class="line">客户端发送完成是 向服务端发送 <span class="string">&#x27;#&#x27;</span> 表示发送完毕</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 服务端 ######################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收数据 (对应客户端方法1)</span></span><br><span class="line"><span class="comment"># def recv_data(connfd):</span></span><br><span class="line"><span class="comment">#     file = open(&quot;student.txt&quot;,&#x27;w&#x27;)</span></span><br><span class="line"><span class="comment">#     while True:</span></span><br><span class="line"><span class="comment">#         data = connfd.recv(1024).decode()</span></span><br><span class="line"><span class="comment">#         if data == &#x27;##&#x27;:</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line"><span class="comment">#         file.write(data + &#x27;\n&#x27;)</span></span><br><span class="line"><span class="comment">#     file.close()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收数据 (对应客户端方法2)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_data</span>(<span class="params">connfd</span>):</span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;student.txt&quot;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    <span class="comment"># data--&gt; xxxx\nxxxx\nxxxx\n</span></span><br><span class="line">    data = connfd.recv(<span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">    file.write(data)</span><br><span class="line">    file.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket()</span><br><span class="line">    sock.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    sock.listen(<span class="number">3</span>)</span><br><span class="line">    connfd,addr = sock.accept()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;连接:&quot;</span>,addr)</span><br><span class="line">    recv_data(connfd) <span class="comment"># 接收数据</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">###################### 客户端  ################################</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">data = [</span><br><span class="line">  <span class="string">&quot;张三  18   177&quot;</span>,</span><br><span class="line">  <span class="string">&quot;李四  19   180&quot;</span>,</span><br><span class="line">  <span class="string">&quot;王五  120  183&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送数据  (处理粘包方法1)</span></span><br><span class="line"><span class="comment"># def send_data(sock):</span></span><br><span class="line"><span class="comment">#     for item in data:</span></span><br><span class="line"><span class="comment">#         sock.send(item.encode())</span></span><br><span class="line"><span class="comment">#         sleep(0.1) # 延迟发送</span></span><br><span class="line"><span class="comment">#     sock.send(b&quot;##&quot;) #   表示发送完成</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送数据  (处理粘包方法2)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_data</span>(<span class="params">sock</span>):</span><br><span class="line">    info = <span class="string">&#x27;\n&#x27;</span>.join(data)</span><br><span class="line">    sock.send(info.encode()) <span class="comment"># 一次性发送</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket()</span><br><span class="line">    sock.connect((<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    send_data(sock) <span class="comment"># 发送数据</span></span><br><span class="line">    sock.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h4 id="2-3-5-TCP与UDP对比"><a href="#2-3-5-TCP与UDP对比" class="headerlink" title="2.3.5 TCP与UDP对比"></a>2.3.5 TCP与UDP对比</h4><ul>
<li><p>传输特征</p>
<ul>
<li>TCP提供可靠的数据传输，但是UDP则不保证传输的可靠性</li>
<li>TCP传输数据处理为字节流，而UDP处理为数据包形式</li>
<li>TCP传输需要建立连接才能进行数据传，效率相对较低，UDP比较自由，无需连接，效率较高</li>
</ul>
</li>
<li><p>套接字编程区别</p>
<ul>
<li>创建的套接字类型不同</li>
<li>tcp套接字会有粘包，udp套接字有消息边界不会粘包</li>
<li>tcp套接字依赖listen accept建立连接才能收发消息，udp套接字则不需要</li>
<li>tcp套接字使用send，recv收发消息，udp套接字使用sendto，recvfrom</li>
</ul>
</li>
<li><p>使用场景</p>
<ul>
<li>tcp更适合对准确性要求高，传输数据较大的场景<ul>
<li>文件传输：如下载电影，访问网页，上传照片</li>
<li>邮件收发</li>
<li>点对点数据传输：如点对点聊天，登录请求，远程访问，发红包</li>
</ul>
</li>
<li>udp更适合对可靠性要求没有那么高，传输方式比较自由的场景<ul>
<li>视频流的传输： 如部分直播，视频聊天等</li>
<li>广播：如网络广播，群发消息</li>
<li>实时传输：如游戏画面</li>
</ul>
</li>
<li>在一个大型的项目中，可能既涉及到TCP网络又有UDP网络</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">完成一个对话小程序，客户端可以发送问题给服务端，服务端接收到问题将对应答案给客户端，客户端打印出来</span><br><span class="line">要求可以同时多个客户端提问，如果问题没有指定答案，则回答 “人家还小，不知道。”</span><br><span class="line"></span><br><span class="line">注意： 不需要使用数据库文件存储应答内容，在服务端用字典表示关键字和答案之间的对应关系即可</span><br><span class="line">&#123;<span class="string">&quot;key&quot;</span>:<span class="string">&quot;value&quot;</span>&#125;</span><br><span class="line">key: 几岁</span><br><span class="line">value ： 我<span class="number">2</span>岁啦</span><br><span class="line"></span><br><span class="line"><span class="comment">################ 服务端 ############################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对话字典</span></span><br><span class="line">chat = &#123;</span><br><span class="line">    <span class="string">&quot;你好&quot;</span>:<span class="string">&quot;你好啊！&quot;</span>,</span><br><span class="line">    <span class="string">&quot;叫什么&quot;</span>:<span class="string">&quot;我叫小美&quot;</span>,</span><br><span class="line">    <span class="string">&quot;男生女生&quot;</span>:<span class="string">&quot;我是机器人啦&quot;</span>,</span><br><span class="line">    <span class="string">&quot;你几岁&quot;</span>:<span class="string">&quot;我2岁啦&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">connfd</span>):</span><br><span class="line">    <span class="comment"># q 客户端问题</span></span><br><span class="line">    q = connfd.recv(<span class="number">1024</span>).decode()</span><br><span class="line">    <span class="keyword">for</span> key,value <span class="keyword">in</span> chat.items():</span><br><span class="line">        <span class="keyword">if</span> key <span class="keyword">in</span> q:</span><br><span class="line">            connfd.send(value.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        connfd.send(<span class="string">&quot;人家还小不知道啦。&quot;</span>.encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket()</span><br><span class="line">    sock.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8888</span>))</span><br><span class="line">    sock.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="comment"># 循环处理对话</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        connfd,addr = sock.accept()</span><br><span class="line">        handle(connfd) <span class="comment"># 接收问题回答问题</span></span><br><span class="line">        connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################  客户端  ###############################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址</span></span><br><span class="line">ADDR = (<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">msg</span>):</span><br><span class="line">    sock = socket()</span><br><span class="line">    sock.connect(ADDR)</span><br><span class="line">    sock.send(msg.encode())</span><br><span class="line">    result = sock.recv(<span class="number">1024</span>)</span><br><span class="line">    sock.close()</span><br><span class="line">    <span class="keyword">return</span> result.decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建套接字</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        msg = <span class="built_in">input</span>(<span class="string">&quot;我：&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> msg:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        result = chat(msg)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;小美：&quot;</span>,result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h3 id="2-4-TCP协议和HTTP协议"><a href="#2-4-TCP协议和HTTP协议" class="headerlink" title="2.4 TCP协议和HTTP协议"></a>2.4 TCP协议和HTTP协议</h3><h4 id="2-4-1-传输流程"><a href="#2-4-1-传输流程" class="headerlink" title="2.4.1 传输流程"></a>2.4.1 传输流程</h4><ul>
<li>发送端由应用程序发送消息，逐层添加首部信息，最终在物理层发送消息包。</li>
<li>发送的消息经过多个节点（交换机，路由器）传输，最终到达目标主机。</li>
<li>目标主机由物理层逐层解析首部消息包，最终到应用程序呈现消息。</li>
</ul>
<p><img src="/./img/14.png"></p>
<h4 id="2-4-2-TCP协议首部信息"><a href="#2-4-2-TCP协议首部信息" class="headerlink" title="2.4.2 TCP协议首部信息"></a>2.4.2 TCP协议首部信息</h4><p><img src="/./img/tcp_head.png"></p>
<ul>
<li><p>源端口和目的端口 各占2个字节，分别写入源端口和目的端口。</p>
</li>
<li><p>序号 占4字节。TCP是面向字节流的。在一个TCP连接中传送的字节流中的每一个字节都按顺序编号。例如，一报文段的序号是301，而接待的数据共有100字节。这就表明本报文段的数据的第一个字节的序号是301，最后一个字节的序号是400。</p>
</li>
<li><p>确认号 占4字节，是期望收到对方下一个报文段的第一个数据字节的序号。例如，B正确收到了A发送过来的一个报文段，其序号字段值是501，而数据长度是200字节（序号501~700），这表明B正确收到了A发送的到序号700为止的数据。因此，B期望收到A的下一个数据序号是701，于是B在发送给A的确认报文段中把确认号置为701。</p>
</li>
<li><p>确认ACK（ACKnowledgment） 仅当ACK &#x3D; 1时确认号字段才有效，当ACK &#x3D; 0时确认号无效。TCP规定，在连接建立后所有的传送的报文段都必须把ACK置为1。</p>
</li>
<li><p>同步SYN（SYNchronization） 在连接建立时用来同步序号。当SYN&#x3D;1而ACK&#x3D;0时，表明这是一个连接请求报文段。对方若同意建立连接，则应在响应的报文段中使SYN&#x3D;1和ACK&#x3D;1，因此SYN置为1就表示这是一个连接请求或连接接受报文。</p>
</li>
<li><p>终止FIN（FINis，意思是“完”“终”） 用来释放一个连接。当FIN&#x3D;1时，表明此报文段的发送发的数据已发送完毕，并要求释放运输连接。</p>
</li>
</ul>
<h4 id="2-4-3-网页访问流程"><a href="#2-4-3-网页访问流程" class="headerlink" title="2.4.3 网页访问流程"></a>2.4.3 网页访问流程</h4><ol>
<li>客户端（浏览器）通过tcp传输，发送http请求给服务端</li>
<li>服务端接收到http请求后进行解析</li>
<li>服务端处理请求内容，组织响应内容</li>
<li>服务端将响应内容以http响应格式发送给浏览器</li>
<li>浏览器接收到响应内容，解析展示</li>
</ol>
<p><img src="/./img/2_wzfw.png"></p>
<h4 id="2-4-4-HTTP协议"><a href="#2-4-4-HTTP协议" class="headerlink" title="2.4.4 HTTP协议"></a>2.4.4 HTTP协议</h4><ul>
<li>用途 ： 网页获取，数据的传输</li>
<li>特点<ul>
<li>应用层协议，使用tcp进行数据传输</li>
<li>简单，灵活，很多语言都有HTTP专门接口</li>
<li>有丰富的请求类型</li>
<li>可以传输的数据类型众多</li>
</ul>
</li>
</ul>
<h4 id="2-4-5-HTTP请求"><a href="#2-4-5-HTTP请求" class="headerlink" title="2.4.5 HTTP请求"></a>2.4.5 HTTP请求</h4><ul>
<li>请求行 ： 具体的请求类别和请求内容</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET         /        HTTP/1.1</span><br><span class="line">请求类别   请求内容     协议版本</span><br></pre></td></tr></table></figure>

<pre><code>请求类别：每个请求类别表示要做不同的事情 
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET : 获取网络资源</span><br><span class="line">POST ：提交一定的信息，得到反馈</span><br><span class="line">HEAD ： 只获取网络资源的响应头</span><br><span class="line">PUT ： 更新服务器资源</span><br><span class="line">DELETE ： 删除服务器资源</span><br></pre></td></tr></table></figure>

<ul>
<li>请求头：对请求的进一步解释和描述</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Accept-Encoding: gzip</span><br></pre></td></tr></table></figure>

<ul>
<li>空行</li>
<li>请求体: 请求参数或者提交内容</li>
</ul>
<p> <img src="/./img/request.jpg"></p>
<h4 id="2-4-6-HTTP响应"><a href="#2-4-6-HTTP响应" class="headerlink" title="2.4.6 HTTP响应"></a>2.4.6 HTTP响应</h4><ul>
<li>响应行 ： 反馈基本的响应情况</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1     200       OK</span><br><span class="line">版本信息    响应码   附加信息</span><br></pre></td></tr></table></figure>

<pre><code>响应码 ： 
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1xx  提示信息，表示请求被接收</span><br><span class="line">2xx  响应成功</span><br><span class="line">3xx  响应需要进一步操作，重定向</span><br><span class="line">4xx  客户端错误</span><br><span class="line">5xx  服务器错误</span><br></pre></td></tr></table></figure>

<ul>
<li>响应头：对响应内容的描述</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Type: text/html</span><br></pre></td></tr></table></figure>

<ul>
<li>空行</li>
<li>响应体：响应的主体内容信息</li>
</ul>
<p><img src="/./img/response.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">HTTP协议示例：</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">http请求和响应 演示</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sock = socket()</span><br><span class="line">sock.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">8000</span>))</span><br><span class="line">sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待浏览器连接</span></span><br><span class="line">connfd,addr = sock.accept()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>,addr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收HTTP请求</span></span><br><span class="line">request = connfd.recv(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(request.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组织响应</span></span><br><span class="line">response = <span class="string">&quot;&quot;&quot;HTTP/1.1 200 OK</span></span><br><span class="line"><span class="string">Content-Type:text/html</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">hello world</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">connfd.send(response.encode())</span><br><span class="line"></span><br><span class="line">connfd.close()</span><br><span class="line">sock.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：将网页 一个图片 通过浏览器访问显示出来</span><br><span class="line">提示 ： Content-<span class="type">Type</span>:image/jpeg</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理http请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">connfd</span>):</span><br><span class="line">    <span class="comment"># 接收http请求</span></span><br><span class="line">    request = connfd.recv(<span class="number">1024</span>).decode()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="comment"># 组织响应</span></span><br><span class="line">    response = <span class="string">&quot;HTTP/1.1 200 OK\r\n&quot;</span></span><br><span class="line">    response += <span class="string">&quot;Content-Type:image/jpeg\r\n&quot;</span></span><br><span class="line">    response += <span class="string">&quot;\r\n&quot;</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;abc.jpeg&quot;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        response =response.encode() +  f.read()</span><br><span class="line">    connfd.send(response <span class="comment"># 发送响应</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket()</span><br><span class="line">    sock.bind((<span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">8000</span>))</span><br><span class="line">    sock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 等待浏览器连接</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        connfd, addr = sock.accept()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>, addr)</span><br><span class="line">        handle(connfd) <span class="comment"># 处理请求</span></span><br><span class="line">        connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h2 id="3-多任务编程"><a href="#3-多任务编程" class="headerlink" title="3. 多任务编程"></a>3. 多任务编程</h2><h3 id="3-1-多任务概述"><a href="#3-1-多任务概述" class="headerlink" title="3.1 多任务概述"></a>3.1 多任务概述</h3><ul>
<li><p>多任务</p>
<p> 即操作系统中可以同时运行多个任务。比如我们可以同时挂着qq，听音乐，同时上网浏览网页。这是我们看得到的任务，在系统中还有很多系统任务在执行,现在的操作系统基本都是多任务操作系统，具备运行多任务的能力。</p>
<p><img src="/./img/13.png"></p>
</li>
<li><p>计算机原理 </p>
<ul>
<li><p>CPU：计算机硬件的核心部件，用于对任务进行执行运算。</p>
<p><img src="/./img/14.jpg"></p>
</li>
<li><p>操作系统调用CPU执行任务</p>
<p><img src="/./img/15.png"></p>
</li>
<li><p>cpu轮询机制 ： cpu都在多个任务之间快速的切换执行，切换速度在微秒级别，其实cpu同时只执行一个任务，但是因为切换太快了，从应用层看好像所有任务同时在执行。</p>
<p><img src="/./img/16.gif"></p>
</li>
<li><p>多核CPU：现在的计算机一般都是多核CPU，比如四核，八核，我们可以理解为由多个单核CPU的集合。这时候在执行任务时就有了选择，可以将多个任务分配给某一个cpu核心，也可以将多个任务分配给多个cpu核心，操作系统会自动根据任务的复杂程度选择最优的分配方案。</p>
<ul>
<li>并发 ： 多个任务如果被分配给了一个cpu内核，那么这多个任务之间就是并发关系，并发关系的多个任务之间并不是真正的”同时”。</li>
<li>并行 ： 多个任务如果被分配给了不同的cpu内核，那么这多个任务之间执行时就是并行关系，并行关系的多个任务时真正的“同时”执行。</li>
</ul>
</li>
</ul>
</li>
<li><p>什么是多任务编程</p>
<p>多任务编程即一个程序中编写多个任务，在程序运行时让这多个任务一起运行，而不是一个一个的顺次执行。</p>
<p>比如微信视频聊天，这时候在微信运行过程中既用到了视频任务也用到了音频任务，甚至同时还能发消息。这就是典型的多任务。而实际的开发过程中这样的情况比比皆是。</p>
<p><img src="/./img/12.jpg"></p>
</li>
<li><p>多任务意义</p>
<ul>
<li><p>提高了任务之间的配合，可以根据运行情况进行任务创建。</p>
<p>比如： 你也不知道用户在微信使用中是否会进行视频聊天，总不能提前启动起来吧，这是需要根据用户的行为启动新任务。</p>
</li>
<li><p>充分利用计算机资源，提高了任务的执行效率。</p>
<ul>
<li>在任务中无阻塞时只有并行状态才能提高效率</li>
</ul>
<p><img src="/./img/17.jpg"></p>
<ul>
<li>在任务中有阻塞时并行并发都能提高效率</li>
</ul>
<p><img src="/./img/18.jpg"></p>
</li>
</ul>
</li>
<li><p>实现多任务编程的方法 ： <strong>多进程编程，多线程编程</strong></p>
</li>
</ul>
<h3 id="3-2-进程（Process）"><a href="#3-2-进程（Process）" class="headerlink" title="3.2 进程（Process）"></a>3.2 进程（Process）</h3><h4 id="3-2-1-进程概述"><a href="#3-2-1-进程概述" class="headerlink" title="3.2.1 进程概述"></a>3.2.1 进程概述</h4><ul>
<li><p>定义： 程序在计算机中的一次执行过程。</p>
<ul>
<li><p>程序是一个可执行的文件，是静态的占有磁盘。</p>
</li>
<li><p>进程是一个动态的过程描述，占有计算机运行资源，有一定的生命周期。</p>
<p><img src="/./img/19.jpg"></p>
</li>
</ul>
</li>
<li><p>进程状态</p>
<ul>
<li><p>三态<br>    就绪态 ： 进程具备执行条件，等待系统调度分配cpu资源<br><br>    运行态 ： 进程占有cpu正在运行<br><br>    等待态 ： 进程阻塞等待，此时会让出cpu<br> <img src="/./img/4_3.png"></p>
</li>
<li><p>五态 (在三态基础上增加新建和终止)</p>
<pre><code>    新建 ： 创建一个进程，获取资源的过程

    终止 ： 进程结束，释放资源的过程
</code></pre>
<p> <img src="/./img/4_5.png"></p>
</li>
</ul>
</li>
<li><p>进程命令</p>
<ul>
<li><p>查看进程信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -aux</span><br><span class="line">kill  -9   pid   可以用于杀死一个进程</span><br></pre></td></tr></table></figure>
<pre><code>![](./img/20.png)
</code></pre>
<ul>
<li>USER : 进程的创建者</li>
<li>PID  :  操作系统分配给进程的编号,大于0的整数，系统中每个进程的PID都不重复。PID也是重要的区分进程的标志。</li>
<li>%CPU,%MEM : 占有的CPU和内存</li>
<li>STAT : 进程状态信息，S I 表示阻塞状态  ，R 表示就绪状态或者运行状态</li>
<li>START : 进程启动时间</li>
<li>COMMAND : 通过什么程序启动的进程</li>
</ul>
</li>
<li><p>进程树形结构</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pstree</span><br></pre></td></tr></table></figure>

<ul>
<li>父子进程：在Linux操作系统中，进程形成树形关系，任务上一级进程是下一级的父进程，下一级进程是上一级的子进程。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="3-2-2-多进程编程"><a href="#3-2-2-多进程编程" class="headerlink" title="3.2.2 多进程编程"></a>3.2.2 多进程编程</h4><ul>
<li><p>使用模块 ： multiprocessing</p>
</li>
<li><p>创建流程</p>
<p>【1】 将需要新进程执行的事件封装为函数</p>
<p>【2】 通过模块的Process类创建进程对象，关联函数</p>
<p>【3】 通过进程对象调用start启动进程</p>
</li>
<li><p>主要类和函数使用</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Process()</span><br><span class="line">功能 ： 创建进程对象</span><br><span class="line">参数 ： target 绑定要执行的目标函数 </span><br><span class="line">       args 元组，用于给target函数位置传参</span><br><span class="line">       kwargs 字典，给target函数键值传参</span><br><span class="line">       daemon  <span class="built_in">bool</span>值，让子进程随父进程退出</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p.start()</span><br><span class="line">功能 ： 启动进程</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 : 启动进程此时target绑定函数开始执行，该函数作为新进程执行内容，此时进程真正被创建</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p.join([timeout])</span><br><span class="line">功能：阻塞等待子进程退出</span><br><span class="line">参数：最长等待时间</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">进程创建示例：</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">进程创建示例 01</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing <span class="keyword">as</span> mp</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span>   <span class="comment"># 全局变量</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程目标函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fun</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始运行一个进程&quot;</span>)</span><br><span class="line">    sleep(<span class="number">4</span>)  <span class="comment"># 模拟事件执行事件</span></span><br><span class="line">    <span class="keyword">global</span> a</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a =&quot;</span>,a)  <span class="comment"># Yes</span></span><br><span class="line">    a = <span class="number">10000</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;进程执行结束&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化进程对象</span></span><br><span class="line">process = mp.Process(target=fun)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动进程  进程产生 执行fun</span></span><br><span class="line">process.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我也做点事情&quot;</span>)</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我也把事情做完了...&quot;</span>)</span><br><span class="line"></span><br><span class="line">process.join() <span class="comment"># 阻塞等待子进程结束</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a:&quot;</span>,a) <span class="comment"># 1  10000</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">进程创建示例02 ： 含有参数的进程函数</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment">#　含有参数的进程函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker</span>(<span class="params">sec,name</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        sleep(sec)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I&#x27;m %s&quot;</span>%name)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I&#x27;m working....&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#　元组位置传参</span></span><br><span class="line"><span class="comment"># p = Process(target=worker,args=(2,&quot;Tom&quot;))</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关键字传参</span></span><br><span class="line">p = Process(target=worker,</span><br><span class="line">            args = (<span class="number">2</span>,),</span><br><span class="line">            kwargs=&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;Tom&quot;</span>&#125;,</span><br><span class="line">            daemon=<span class="literal">True</span>) <span class="comment"># 子进程伴随父进程结束</span></span><br><span class="line">p.start()</span><br><span class="line">sleep(<span class="number">3</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><p>进程执行现象理解 （难点）</p>
<ul>
<li>新的进程是原有进程的子进程，子进程复制父进程全部内存空间代码段，一个进程可以创建多个子进程。</li>
<li>子进程只执行指定的函数，其余内容均是父进程执行内容，但是子进程也拥有其他父进程资源。</li>
<li>各个进程在执行上互不影响，也没有先后顺序关系。</li>
<li>进程创建后，各个进程空间独立，相互没有影响。</li>
<li>multiprocessing 创建的子进程中无法使用标准输入（即无法使用input）。</li>
</ul>
</li>
</ul>
<h4 id="3-2-3-进程处理细节"><a href="#3-2-3-进程处理细节" class="headerlink" title="3.2.3 进程处理细节"></a>3.2.3 进程处理细节</h4><ul>
<li>进程相关函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.getpid()</span><br><span class="line">功能： 获取一个进程的PID值</span><br><span class="line">返回值： 返回当前进程的PID </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">os.getppid()</span><br><span class="line">功能： 获取父进程的PID号</span><br><span class="line">返回值： 返回父进程PID</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sys.exit(info)</span><br><span class="line">功能：退出进程</span><br><span class="line">参数：字符串 表示退出时打印内容</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">创建多个子进程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> sys, os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">th1</span>():</span><br><span class="line">    sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;吃饭&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getppid(), <span class="string">&quot;--&quot;</span>, os.getpid())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">th2</span>():</span><br><span class="line">    <span class="comment"># sys.exit(&quot;不能睡觉了&quot;) # 进程结束</span></span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;睡觉&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getppid(), <span class="string">&quot;--&quot;</span>, os.getpid())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">th3</span>():</span><br><span class="line">    sleep(<span class="number">2</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;打豆豆&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getppid(), <span class="string">&quot;--&quot;</span>, os.getpid())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环创建子进程</span></span><br><span class="line">jobs = [] <span class="comment"># 存放每个进程对象</span></span><br><span class="line"><span class="keyword">for</span> th <span class="keyword">in</span> [th1, th2, th3]:</span><br><span class="line">    p = Process(target=th)</span><br><span class="line">    jobs.append(p) <span class="comment"># 存入jobs</span></span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line"><span class="comment">#  确保三件事都结束</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> jobs:</span><br><span class="line">    i.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;三件事完成&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：大文件拆分</span><br><span class="line">有一个大文件，将其拆分成上下两个部分 （按照字节大小），要求两个部分拆分要同步进行</span><br><span class="line">plus ： 假设文件很大不要一次read读取全部</span><br><span class="line"></span><br><span class="line">提示 ： os.path.getsize() 获取文件大小</span><br><span class="line">       创建两个子进程分别拆上下两个部分</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;./dict.txt&quot;</span></span><br><span class="line">size = os.path.getsize(filename)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果父进程打开子进程直接用则会公用一个文件偏移量</span></span><br><span class="line"><span class="comment"># fr = open(filename,&#x27;rb&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">top</span>():</span><br><span class="line">    fr = <span class="built_in">open</span>(filename,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    fw = <span class="built_in">open</span>(<span class="string">&#x27;top.txt&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    n = size // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> n &gt;= <span class="number">1024</span>:</span><br><span class="line">        fw.write(fr.read(<span class="number">1024</span>))</span><br><span class="line">        n -= <span class="number">1024</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        fw.write(fr.read(n))</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bot</span>():</span><br><span class="line">    fr = <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    fw = <span class="built_in">open</span>(<span class="string">&#x27;bot.txt&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    fr.seek(size//<span class="number">2</span>,<span class="number">0</span>)  <span class="comment"># 文件偏移量到中间</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = fr.read(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fw.write(data)</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line"></span><br><span class="line">jobs=[]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> [top,bot]:</span><br><span class="line">    p = Process(target=item)</span><br><span class="line">    jobs.append(p)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">[i.join() <span class="keyword">for</span> i <span class="keyword">in</span> jobs]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;拆分完成&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3-2-4-创建进程类"><a href="#3-2-4-创建进程类" class="headerlink" title="3.2.4 创建进程类"></a>3.2.4 创建进程类</h4><p>进程的基本创建方法将子进程执行的内容封装为函数。如果我们更热衷于面向对象的编程思想，也可以使用类来封装进程内容。</p>
<ul>
<li><p>创建步骤</p>
<p>【1】 继承Process类</p>
<p>【2】 重写<code>__init__</code>方法添加自己的属性，使用super()加载父类属性</p>
<p>【3】 重写run()方法</p>
</li>
<li><p>使用方法</p>
<p>【1】 实例化对象</p>
<p>【2】 调用start自动执行run方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">自定义进程类</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyProcess</span>(<span class="title class_ inherited__">Process</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, value</span>):</span><br><span class="line">        <span class="variable language_">self</span>.value = value</span><br><span class="line">        <span class="built_in">super</span>().__init__()  <span class="comment"># 调用父类的init</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 重写run 作为进程的执行内容</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.value):</span><br><span class="line">            sleep(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;自定义进程类。。。。&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = MyProcess(<span class="number">3</span>)</span><br><span class="line">p.start() <span class="comment"># 将 run方法作为进程执行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">模拟龟兔赛跑场景，赛程一个<span class="number">100</span>米，创建一个类，实例化两个对象，分别表示龟和兔，实例化对象时可以传入龟和兔的速度龟每秒<span class="number">1</span>米（忍者神龟），兔每秒<span class="number">5</span>米，但是兔每跑<span class="number">10</span>米休息<span class="number">2</span>秒，执行这两个进程，每隔<span class="number">2</span>秒打印一次两者跑的距离，直到两者都跑到终点为止。</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-2-5-进程间通信"><a href="#3-2-5-进程间通信" class="headerlink" title="3.2.5 进程间通信"></a>3.2.5 进程间通信</h4><ul>
<li><p>必要性： 进程间空间独立，资源不共享，此时在需要进程间数据传输时就需要特定的手段进行数据通信。</p>
</li>
<li><p>常用进程间通信方法：消息队列，套接字等。</p>
</li>
<li><p>消息队列使用</p>
<ul>
<li><p>通信原理： 在内存中开辟空间，建立队列模型，进程通过队列将消息存入，或者从队列取出完成进程间通信。</p>
</li>
<li><p>实现方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line">q = Queue(maxsize=<span class="number">0</span>)</span><br><span class="line">功能: 创建队列对象</span><br><span class="line">参数：最多存放消息个数</span><br><span class="line">返回值：队列对象</span><br><span class="line"></span><br><span class="line">q.put(data)</span><br><span class="line">功能：向队列存入消息</span><br><span class="line">参数：data  要存入的内容</span><br><span class="line"></span><br><span class="line">q.get()</span><br><span class="line">功能：从队列取出消息</span><br><span class="line">返回值： 返回获取到的内容</span><br><span class="line"></span><br><span class="line">q.full()   判断队列是否为满</span><br><span class="line">q.empty()  判断队列是否为空</span><br><span class="line">q.qsize()  获取队列中消息个数</span><br><span class="line">q.close()  关闭队列</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">进程间通信示例：</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建消息队列</span></span><br><span class="line">q = Queue(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子进程函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        cmd = q.get() <span class="comment"># 取出指令</span></span><br><span class="line">        <span class="keyword">if</span> cmd == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n完成指令1&quot;</span>)</span><br><span class="line">        <span class="keyword">elif</span> cmd == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;\n完成指令2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建进程</span></span><br><span class="line">p = Process(target=handle,daemon=<span class="literal">True</span>)</span><br><span class="line">p.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>  <span class="literal">True</span>:</span><br><span class="line">    cmd = <span class="built_in">input</span>(<span class="string">&quot;指令：&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> cmd:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    q.put(cmd) <span class="comment"># 通过队列给子进程</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">有一个目录中有若干普通文件，将该目录复制一份到当前程序所在位置</span><br><span class="line">要求： 目标文件夹中每个文件复制都采用一个独立的进程完成</span><br><span class="line">      当所有文件复制完成之后，按复制完成顺序打印所有文件名</span><br><span class="line">提示：</span><br><span class="line">创建文件夹 ： os.mkdir(<span class="built_in">dir</span>)  os.listdir()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process, Queue</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消息队列</span></span><br><span class="line">q = Queue()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进程函数  复制文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">copy</span>(<span class="params">old,new,file</span>):</span><br><span class="line">    fr = <span class="built_in">open</span>(old+<span class="string">&#x27;/&#x27;</span>+file,<span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    fw = <span class="built_in">open</span>(new+<span class="string">&#x27;/&#x27;</span>+file,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = fr.read()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        fw.write(data)</span><br><span class="line">    fr.close()</span><br><span class="line">    fw.close()</span><br><span class="line">    q.put(file) <span class="comment">#  存入队列</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 入口函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">old</span>):</span><br><span class="line">    new = old.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    os.mkdir(new)  <span class="comment">#  创建新文件夹</span></span><br><span class="line">    jobs = []  <span class="comment"># 存放每个进程对象</span></span><br><span class="line">    <span class="comment"># 循环创建进程 file --&gt; 文件名称</span></span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(old):</span><br><span class="line">        p = Process(target=copy,args=(old,new,file))</span><br><span class="line">        jobs.append(p)</span><br><span class="line">        p.start()</span><br><span class="line">    [i.join() <span class="keyword">for</span> i <span class="keyword">in</span> jobs] <span class="comment"># 判断所有进程结束</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;拷贝了如下文件:&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> q.qsize():</span><br><span class="line">        <span class="built_in">print</span>(q.get())</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main(<span class="string">&quot;/home/tarena/FTP&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>**群聊聊天室 **</p>
<blockquote>
<p>功能 ： 类似qq群功能</p>
<p>【1】 有人进入聊天室需要输入姓名，姓名不能重复</p>
<p>【2】 有人进入聊天室时，其他人会收到通知：<strong>Lucy 进入了聊天室</strong></p>
<p>【3】 一个人发消息，其他人会收到：   <strong>Lucy ： 一起出去玩啊。</strong></p>
<p>【4】 有人退出聊天室，则其他人也会收到通知 :  <strong>Lucy 退出了聊天室</strong></p>
<p>【5】 扩展功能：服务器可以向所有用户发送公告:    <strong>管理员消息： 大家好，欢迎进入聊天室。</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################ 服务端参考代码 ###################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址</span></span><br><span class="line">HOST = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">PORT = <span class="number">8888</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存储用户信息 &#123;name:address&#125;</span></span><br><span class="line">user = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理进入聊天室</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">sock, name, address</span>):</span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> user <span class="keyword">or</span> <span class="string">&quot;管理&quot;</span> <span class="keyword">in</span> name:</span><br><span class="line">        sock.sendto(<span class="string">b&quot;FAIL&quot;</span>, address)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        sock.sendto(<span class="string">b&quot;OK&quot;</span>, address)</span><br><span class="line">        <span class="comment"># 告知其他人</span></span><br><span class="line">        msg = <span class="string">&quot;欢迎 %s 进入聊天室&quot;</span> % name</span><br><span class="line">        <span class="keyword">for</span> key, value <span class="keyword">in</span> user.items():</span><br><span class="line">            sock.sendto(msg.encode(), value)</span><br><span class="line">        user[name] = address  <span class="comment"># 存储用户</span></span><br><span class="line">        <span class="comment"># print(user)  # 测试</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理聊天</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chat</span>(<span class="params">sock, name, content</span>):</span><br><span class="line">    msg = <span class="string">&quot;%s : %s&quot;</span> % (name, content)</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> user.items():</span><br><span class="line">        <span class="comment"># 不是本人就发送</span></span><br><span class="line">        <span class="keyword">if</span> key != name:</span><br><span class="line">            sock.sendto(msg.encode(), value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理退出</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exit</span>(<span class="params">sock, name</span>):</span><br><span class="line">    <span class="keyword">if</span> name <span class="keyword">in</span> user:</span><br><span class="line">        <span class="keyword">del</span> user[name]  <span class="comment"># 删除该用户</span></span><br><span class="line">    <span class="comment"># 通知其他用户</span></span><br><span class="line">    msg = <span class="string">&quot;%s 退出聊天室&quot;</span> % name</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> user.items():</span><br><span class="line">        sock.sendto(msg.encode(), value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">sock</span>):</span><br><span class="line">    <span class="comment"># 不断接收请求，分情况讨论</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        request, addr = sock.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        tmp = request.decode().split(<span class="string">&quot; &quot;</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="comment"># 分情况讨论</span></span><br><span class="line">        <span class="keyword">if</span> tmp[<span class="number">0</span>] == <span class="string">&quot;LOGIN&quot;</span>:</span><br><span class="line">            <span class="comment"># tmp -&gt;[LOGIN,name]</span></span><br><span class="line">            login(sock, tmp[<span class="number">1</span>], addr)</span><br><span class="line">        <span class="keyword">elif</span> tmp[<span class="number">0</span>] == <span class="string">&quot;CHAT&quot;</span>:</span><br><span class="line">            <span class="comment"># tmp -&gt;[CHAT,name,content]</span></span><br><span class="line">            chat(sock, tmp[<span class="number">1</span>], tmp[<span class="number">2</span>])</span><br><span class="line">        <span class="keyword">elif</span> tmp[<span class="number">0</span>] == <span class="string">&quot;EXIT&quot;</span>:</span><br><span class="line">            <span class="comment"># tmp -&gt;[EXIT,name]</span></span><br><span class="line">            exit(sock, tmp[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 程序入口函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 创建udp</span></span><br><span class="line">    sock = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">    sock.bind(ADDR)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收请求，分类处理</span></span><br><span class="line">    p = Process(target=handle, args=(sock,), daemon=<span class="literal">True</span>)</span><br><span class="line">    p.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        content = <span class="built_in">input</span>(<span class="string">&quot;管理员消息:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> content:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        msg = <span class="string">&quot;CHAT 管理员消息 &quot;</span> + content</span><br><span class="line">        <span class="comment"># 从父进程发送到子进程</span></span><br><span class="line">        sock.sendto(msg.encode(), ADDR)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">################## 客户端参考代码 ##################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器地址</span></span><br><span class="line">SERVER_ADDR = (<span class="string">&quot;124.71.188.218&quot;</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">sock</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        name = <span class="built_in">input</span>(<span class="string">&quot;请输入昵称:&quot;</span>)</span><br><span class="line">        <span class="comment"># 组织请求</span></span><br><span class="line">        msg = <span class="string">&quot;LOGIN &quot;</span> + name</span><br><span class="line">        sock.sendto(msg.encode(), SERVER_ADDR)</span><br><span class="line">        result, addr = sock.recvfrom(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> result == <span class="string">b&quot;OK&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;进入聊天室&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该昵称已存在&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 子进程接收函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">recv_msg</span>(<span class="params">sock</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data, addr = sock.recvfrom(<span class="number">1024</span> * <span class="number">10</span>)</span><br><span class="line">        <span class="comment"># 格式处理</span></span><br><span class="line">        content = <span class="string">&quot;\n&quot;</span> + data.decode() + <span class="string">&quot;\n发言：&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(content, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 　父进程发送函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_msg</span>(<span class="params">sock, name</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            content = <span class="built_in">input</span>(<span class="string">&quot;发言：&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            content = <span class="string">&quot;exit&quot;</span></span><br><span class="line">        <span class="comment"># 表示退出</span></span><br><span class="line">        <span class="keyword">if</span> content == <span class="string">&#x27;exit&#x27;</span>:</span><br><span class="line">            msg = <span class="string">&quot;EXIT &quot;</span> + name</span><br><span class="line">            sock.sendto(msg.encode(), SERVER_ADDR)</span><br><span class="line">            sys.exit(<span class="string">&quot;您已退出聊天室&quot;</span>)</span><br><span class="line">        msg = <span class="string">&quot;CHAT %s %s&quot;</span> % (name, content)</span><br><span class="line">        sock.sendto(msg.encode(), SERVER_ADDR)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    sock = socket(AF_INET, SOCK_DGRAM)</span><br><span class="line">    sock.bind((<span class="string">&quot;0.0.0.0&quot;</span>,<span class="number">55224</span>)) <span class="comment"># 端口不要变</span></span><br><span class="line">    name = login(sock)  <span class="comment"># 请求进入聊天室</span></span><br><span class="line">    <span class="comment"># 子进程负责接收</span></span><br><span class="line">    p = Process(target=recv_msg, args=(sock,), daemon=<span class="literal">True</span>)</span><br><span class="line">    p.start()</span><br><span class="line">    send_msg(sock, name)  <span class="comment"># 发送消息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="3-3-线程-Thread"><a href="#3-3-线程-Thread" class="headerlink" title="3.3 线程 (Thread)"></a>3.3 线程 (Thread)</h3><h4 id="3-3-1-线程概述"><a href="#3-3-1-线程概述" class="headerlink" title="3.3.1 线程概述"></a>3.3.1 线程概述</h4><ul>
<li><p>什么是线程</p>
<p>【1】 线程被称为轻量级的进程，也是多任务编程方式</p>
<p>【2】 也可以利用计算机的多cpu资源</p>
<p>【3】 线程可以理解为进程中再开辟的分支任务</p>
</li>
<li><p>线程特征</p>
<p>【1】 一个进程中可以包含多个线程</p>
<p>【2】 线程也是一个运行行为，消耗计算机资源</p>
<p>【3】 一个进程中的所有线程共享这个进程的资源</p>
<p>【4】 多个线程之间的运行同样互不影响各自运行</p>
<p>【5】 线程的创建和销毁消耗资源远小于进程</p>
<p><img src="/./img/21.jpg"></p>
</li>
</ul>
<h4 id="3-3-2-多线程编程"><a href="#3-3-2-多线程编程" class="headerlink" title="3.3.2 多线程编程"></a>3.3.2 多线程编程</h4><ul>
<li>线程模块： threading</li>
</ul>
<p><img src="/./img/22.jpg"></p>
<ul>
<li><p>创建方法</p>
<p>【1】 创建线程对象</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread </span><br><span class="line"></span><br><span class="line">t = Thread()</span><br><span class="line">功能：创建线程对象</span><br><span class="line">参数：target 绑定线程函数</span><br><span class="line">     args   元组 给线程函数位置传参</span><br><span class="line">     kwargs 字典 给线程函数键值传参</span><br><span class="line">     daemon <span class="built_in">bool</span>值，主线程推出时该分支线程也推出</span><br></pre></td></tr></table></figure>

<pre><code>【2】 启动线程
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">t.start()</span><br></pre></td></tr></table></figure>

<pre><code>【3】等待分支线程结束
</code></pre>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">t.join([timeout])</span><br><span class="line">功能：阻塞等待分支线程退出</span><br><span class="line">参数：最长等待时间</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">线程示例01：</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  线程函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">music</span>():</span><br><span class="line">    <span class="keyword">global</span> a</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a =&quot;</span>,a)</span><br><span class="line">    a = <span class="number">10000</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        sleep(<span class="number">2</span>)</span><br><span class="line">        <span class="built_in">print</span>(os.getpid(),<span class="string">&quot;播放:黄河大合唱&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化线程对象</span></span><br><span class="line">thread = threading.Thread(target=music)</span><br><span class="line"><span class="comment"># 启动线程 线程存在</span></span><br><span class="line">thread.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(os.getpid(),<span class="string">&quot;播放:葫芦娃&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 阻塞等待分支线程结束</span></span><br><span class="line">thread.join()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;a:&quot;</span>,a)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">线程示例02：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 带有参数的线程函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">sec,name</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;含有参数的线程来喽&quot;</span>)</span><br><span class="line">    sleep(sec)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;%s 线程执行完毕&quot;</span>%name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环创建线程</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    t = Thread(target=func,</span><br><span class="line">               args=(<span class="number">2</span>,),</span><br><span class="line">               kwargs=&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;T-%d&quot;</span>%i&#125;,</span><br><span class="line">               daemon=<span class="literal">True</span>)</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure>



<h4 id="3-3-3-创建线程类"><a href="#3-3-3-创建线程类" class="headerlink" title="3.3.3 创建线程类"></a>3.3.3 创建线程类</h4><ol>
<li><p>创建步骤</p>
<p>【1】 继承Thread类</p>
<p>【2】 重写<code>__init__</code>方法添加自己的属性，使用super()加载父类属性</p>
<p>【3】 重写run()方法</p>
</li>
<li><p>使用方法</p>
<p>【1】 实例化对象</p>
<p>【2】 调用start自动执行run方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,song</span>):</span><br><span class="line">        <span class="variable language_">self</span>.song = song</span><br><span class="line">        <span class="built_in">super</span>().__init__() <span class="comment"># 得到父类内容</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 线程要做的事情</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            sleep(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;播放:&quot;</span>,<span class="variable language_">self</span>.song)</span><br><span class="line"></span><br><span class="line">t = MyThread(<span class="string">&quot;凉凉&quot;</span>)</span><br><span class="line">t.start() <span class="comment"># 运行run</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">现在有<span class="number">500</span>张票，存在一个列表中 [<span class="string">&quot;T1&quot;</span>,....<span class="string">&quot;T500&quot;</span>]，<span class="number">10</span>个窗口同时卖这<span class="number">500</span>张票 W1-W10</span><br><span class="line"></span><br><span class="line">使用<span class="number">10</span>个线程模拟这<span class="number">10</span>个窗口，同时卖票，直到所有的票都卖出为止，每出一张票 需要<span class="number">0.1</span>秒，打印表示即可<span class="built_in">print</span>(<span class="string">&quot;W1----T250&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line">lock = Lock() <span class="comment"># 创建锁</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将票准备好</span></span><br><span class="line">ticket = [<span class="string">&quot;T%d&quot;</span> % x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">501</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线程函数 w:表示窗口</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sell</span>(<span class="params">w</span>):</span><br><span class="line">    <span class="keyword">while</span> ticket:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%s --- %s&quot;</span>%(w,ticket.pop(<span class="number">0</span>)))</span><br><span class="line">        sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10个线程</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">11</span>):</span><br><span class="line">    t = Thread(target=sell,args=(<span class="string">&quot;W%d&quot;</span>%i,))</span><br><span class="line">    t.start()</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-3-4-线程同步互斥"><a href="#3-3-4-线程同步互斥" class="headerlink" title="3.3.4 线程同步互斥"></a>3.3.4 线程同步互斥</h4><ul>
<li><p>线程通信方法： 线程间使用全局变量进行通信</p>
</li>
<li><p>共享资源争夺</p>
<ul>
<li>共享资源：多线程都可以操作的资源称为共享资源。对共享资源的操作代码段称为临界区。</li>
<li>影响 ： 对共享资源的无序操作可能会带来数据的混乱，或者操作错误。此时往往需要同步互斥机制协调操作顺序。</li>
</ul>
</li>
<li><p>同步互斥机制</p>
<ul>
<li><p>同步 ： 同步是一种协作关系，为完成操作，线程间形成一种协调，按照必要的步骤有序执行操作。</p>
<p><img src="/./img/7_tb.png"></p>
</li>
<li><p>互斥 ： 互斥是一种制约关系，当一个进程或者线程占有资源时会进行加锁处理，此时其他进程线程就无法操作该资源，直到解锁后才能操作。</p>
</li>
</ul>
</li>
</ul>
<p><img src="/./img/7_hc.png"></p>
<ul>
<li>线程Event</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Event</span><br><span class="line"></span><br><span class="line">e = Event()  创建线程event对象</span><br><span class="line"></span><br><span class="line">e.wait([timeout])  阻塞等待e被<span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">e.<span class="built_in">set</span>()  设置e，使wait结束阻塞</span><br><span class="line"></span><br><span class="line">e.clear() 使e回到未被设置状态</span><br><span class="line"></span><br><span class="line">e.is_set()  查看当前e是否被设置</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Event使用示例：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Event</span><br><span class="line"></span><br><span class="line">msg = <span class="literal">None</span>  <span class="comment"># 通信变量</span></span><br><span class="line">e = Event()  <span class="comment"># 事件对象</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">杨子荣</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;杨子荣前来拜山头&quot;</span>)</span><br><span class="line">    <span class="keyword">global</span> msg</span><br><span class="line">    msg = <span class="string">&quot;天王盖地虎&quot;</span></span><br><span class="line">    e.<span class="built_in">set</span>()  <span class="comment"># 通知主线程可以判断</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = Thread(target=杨子荣)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;说对口令才是自己人&quot;</span>)</span><br><span class="line">e.wait()  <span class="comment"># 阻塞等待通知</span></span><br><span class="line"><span class="keyword">if</span> msg == <span class="string">&quot;天王盖地虎&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;宝塔镇河妖&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;确认过眼神你是对的人&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;打死他.... 无情啊 哥哥....&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>线程锁 Lock</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span>  threading <span class="keyword">import</span> Lock</span><br><span class="line"></span><br><span class="line">lock = Lock()  创建锁对象</span><br><span class="line">lock.acquire() 上锁  如果lock已经上锁再调用会阻塞</span><br><span class="line">lock.release() 解锁</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Lock使用示例：</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread, Lock</span><br><span class="line"></span><br><span class="line">lock = Lock() <span class="comment">#　创建锁</span></span><br><span class="line">a = b = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">value</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        lock.acquire() <span class="comment"># 上锁</span></span><br><span class="line">        <span class="keyword">if</span> a != b:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;a = %d,b = %d&quot;</span> % (a, b))</span><br><span class="line">        lock.release() <span class="comment"># 解锁</span></span><br><span class="line"></span><br><span class="line">t = Thread(target=value)</span><br><span class="line">t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    lock.acquire()</span><br><span class="line">    a += <span class="number">1</span></span><br><span class="line">    b += <span class="number">1</span></span><br><span class="line">    lock.release()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">随堂练习：</span><br><span class="line">使用两个分支线程，一个线程打印<span class="number">1</span>-<span class="number">52</span> 这<span class="number">52</span>个数字，另一个线程打印A-Z 这<span class="number">26</span>个字母。要求同时执行两个线程，打印顺序为： 12A34B...<span class="number">.5152</span>Z</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"></span><br><span class="line">lock1 = Lock()</span><br><span class="line">lock2 = Lock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_num</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">53</span>,<span class="number">2</span>):</span><br><span class="line">        lock1.acquire()</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(i + <span class="number">1</span>)</span><br><span class="line">        lock2.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">print_chr</span>():</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65</span>,<span class="number">91</span>):</span><br><span class="line">        lock2.acquire()</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(i))</span><br><span class="line">        lock1.release()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = Thread(target=print_num)</span><br><span class="line">t2 = Thread(target=print_chr)</span><br><span class="line"></span><br><span class="line">lock2.acquire() <span class="comment"># 先把打印字母的部分锁住</span></span><br><span class="line"></span><br><span class="line">t1.start()</span><br><span class="line">t2.start()</span><br></pre></td></tr></table></figure>



<h4 id="3-3-5-死锁"><a href="#3-3-5-死锁" class="headerlink" title="3.3.5 死锁"></a>3.3.5 死锁</h4><ul>
<li><p>什么是死锁</p>
<p>死锁是指两个或两个以上的线程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁。</p>
</li>
</ul>
<p><img src="/./img/ss.jpg"></p>
<ul>
<li><p>死锁产生条件</p>
<ul>
<li><p>互斥条件：指线程使用了互斥方法，使用一个资源时其他线程无法使用。</p>
</li>
<li><p>请求和保持条件：指线程已经保持至少一个资源，但又提出了新的资源请求，在获取到新的资源前不会释放自己保持的资源。</p>
</li>
<li><p>不剥夺条件：不会受到线程外部的干扰，如系统强制终止线程等。</p>
</li>
<li><p>环路等待条件：指在发生死锁时，必然存在一个线程——资源的环形链，如 T0正在等待一个T1占用的资源；T1正在等待T2占用的资源，……，Tn正在等待已被T0占用的资源。</p>
</li>
</ul>
</li>
<li><p>如何避免死锁</p>
<ul>
<li>逻辑清晰，不要同时出现上述死锁产生的四个条件</li>
<li>通过测试工程师进行死锁检测</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">死锁现象演示：</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">死锁现象演示</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread,Lock</span><br><span class="line"></span><br><span class="line"><span class="comment"># 账户类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Account</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,<span class="built_in">id</span>,balance,lock</span>):</span><br><span class="line">        <span class="variable language_">self</span>._<span class="built_in">id</span> = <span class="built_in">id</span></span><br><span class="line">        <span class="variable language_">self</span>._balance = balance</span><br><span class="line">        <span class="variable language_">self</span>.lock = lock</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取钱</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">withdraw</span>(<span class="params">self,amount</span>):</span><br><span class="line">        <span class="variable language_">self</span>._balance -= amount</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 存钱</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">deposit</span>(<span class="params">self,amount</span>):</span><br><span class="line">        <span class="variable language_">self</span>._balance += amount</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查看余额</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">getBalance</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._balance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转账函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transfer</span>(<span class="params">from_,to,amount</span>):</span><br><span class="line">    from_.lock.acquire()</span><br><span class="line">    from_.withdraw(amount) <span class="comment"># from_钱减少</span></span><br><span class="line">    from_.lock.release() <span class="comment"># 不会产生死锁</span></span><br><span class="line">    sleep(<span class="number">0.1</span>) <span class="comment"># 网络延迟</span></span><br><span class="line"></span><br><span class="line">    to.lock.acquire()</span><br><span class="line">    to.deposit(amount) <span class="comment"># to钱增加</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># from_.lock.release() # 产生死锁</span></span><br><span class="line">    to.lock.release()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    tom = Account(<span class="string">&quot;Tom&quot;</span>,<span class="number">5000</span>,Lock())</span><br><span class="line">    abby = Account(<span class="string">&quot;abby&quot;</span>,<span class="number">8000</span>,Lock())</span><br><span class="line"></span><br><span class="line">    t1 = Thread(target=transfer,args=(tom,abby,<span class="number">2000</span>))</span><br><span class="line">    t2 = Thread(target=transfer,args=(abby,tom,<span class="number">3000</span>))</span><br><span class="line">    t1.start()</span><br><span class="line">    t2.start()</span><br><span class="line">    t1.join()</span><br><span class="line">    t2.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Tom:&quot;</span>,tom.getBalance())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Abby:&quot;</span>,abby.getBalance())</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="3-3-6-GIL问题"><a href="#3-3-6-GIL问题" class="headerlink" title="3.3.6 GIL问题"></a>3.3.6 GIL问题</h4><ul>
<li><p>什么是GIL问题 （全局解释器锁）</p>
<p>由于python解释器设计中加入了解释器锁，导致python解释器同一时刻只能解释执行一个线程，大大降低了线程的执行效率。</p>
</li>
<li><p>导致后果<br>因为遇到阻塞时线程会主动让出解释器，去解释其他线程。所以python多线程在执行多阻塞任务时可以提升程序效率，其他情况并不能对效率有所提升。</p>
</li>
<li><p>关于GIL问题的处理</p>
<ul>
<li><p>尽量使用进程完成无阻塞的并发行为</p>
</li>
<li><p>不使用c作为解释器 （可以用Java  C#）</p>
</li>
</ul>
<p>   Guido的声明：<a target="_blank" rel="noopener" href="http://www.artima.com/forums/flat.jsp?forum=106&amp;thread=214235">http://www.artima.com/forums/flat.jsp?forum=106&amp;thread=214235</a></p>
</li>
<li><p>结论 </p>
<ul>
<li>GIL问题与Python语言本身并没什么关系，属于解释器设计的历史问题。</li>
<li>在无阻塞状态下，多线程程序程序执行效率并不高，甚至还不如单线程效率。</li>
<li>Python多线程只适用于执行有阻塞延迟的任务情形。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">线程效率对比进程实验：</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prime</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="comment"># 判断一个数是否为质数</span></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n</span>):</span><br><span class="line">        <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>,n // <span class="number">2</span> + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,begin,end</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__begin = begin</span><br><span class="line">        <span class="variable language_">self</span>.__end = end</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        prime = [] <span class="comment"># 存放所有质数</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="variable language_">self</span>.__begin,<span class="variable language_">self</span>.__end):</span><br><span class="line">            <span class="keyword">if</span> Prime.is_prime(i):</span><br><span class="line">                prime.append(i)</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">sum</span>(prime))</span><br><span class="line"></span><br><span class="line"><span class="meta">@timeis</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_10</span>():</span><br><span class="line">    jobs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">100001</span>,<span class="number">10000</span>):</span><br><span class="line">        t = Prime(i,i + <span class="number">10000</span>)</span><br><span class="line">        jobs.append(t)</span><br><span class="line">        t.start()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> jobs:</span><br><span class="line">        i.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    process_10()</span><br></pre></td></tr></table></figure>



<h4 id="3-3-7-进程线程的区别联系"><a href="#3-3-7-进程线程的区别联系" class="headerlink" title="3.3.7 进程线程的区别联系"></a>3.3.7 进程线程的区别联系</h4><ul>
<li>区别联系</li>
</ul>
<ol>
<li>两者都是多任务编程方式，都能使用计算机多核资源</li>
<li>进程的创建删除消耗的计算机资源比线程多</li>
<li>进程空间独立，数据互不干扰，有专门通信方法；线程使用全局变量通信</li>
<li>一个进程可以有多个分支线程，两者有包含关系</li>
<li>多个线程共享进程资源，在共享资源操作时往往需要同步互斥处理</li>
<li>Python线程存在GIL问题，但是进程没有。</li>
</ol>
<ul>
<li><p>使用场景</p>
<p><img src="/./img/23.jpg"></p>
</li>
</ul>
<ol>
<li>任务场景：一个大型服务，往往包含多个独立的任务模块，每个任务模块又有多个小独立任务构成，此时整个项目可能有多个进程，每个进程又有多个线程。</li>
<li>编程语言：Java,C#之类的编程语言在执行多任务时一般都是用线程完成，因为线程资源消耗少；而Python由于GIL问题往往使用多进程。</li>
</ol>
<h2 id="4-网络并发模型"><a href="#4-网络并发模型" class="headerlink" title="4. 网络并发模型"></a>4. 网络并发模型</h2><h3 id="4-1-网络并发模型概述"><a href="#4-1-网络并发模型概述" class="headerlink" title="4.1 网络并发模型概述"></a>4.1 网络并发模型概述</h3><ul>
<li><p>什么是网络并发</p>
<p>在实际工作中，一个服务端程序往往要应对多个客户端同时发起访问的情况。如果让服务端程序能够更好的同时满足更多客户端网络请求的情形，这就是并发网络模型。</p>
<p><img src="/./img/24.jpg"></p>
</li>
<li><p>循环网络模型问题</p>
<p>循环网络模型只能循环接收客户端请求，处理请求。同一时刻只能处理一个请求，处理完毕后再处理下一个。这样的网络模型虽然简单，资源占用不多，但是无法同时处理多个客户端请求就是其最大的弊端，往往只有在一些低频的小请求任务中才会使用。</p>
</li>
</ul>
<h3 id="4-2-多进程-线程并发模型"><a href="#4-2-多进程-线程并发模型" class="headerlink" title="4.2 多进程&#x2F;线程并发模型"></a>4.2 多进程&#x2F;线程并发模型</h3><p>多进程&#x2F;线程并发模中每当一个客户端连接服务器，就创建一个新的进程&#x2F;线程为该客户端服务，客户端退出时再销毁该进程&#x2F;线程，多任务并发模型也是实际工作中最为常用的服务端处理模型。</p>
<ul>
<li><p>模型特点</p>
<ul>
<li>优点：能同时满足多个客户端长期占有服务端需求，可以处理各种请求。</li>
<li>缺点： 资源消耗较大</li>
<li>适用情况：客户端请求较复杂，需要长时间占有服务器。</li>
</ul>
</li>
<li><p>创建流程</p>
<ul>
<li>创建网络套接字</li>
<li>等待客户端连接</li>
<li>有客户端连接，则创建新的进程&#x2F;线程具体处理客户端请求</li>
<li>主进程&#x2F;线程继续等待处理其他客户端连接</li>
<li>如果客户端退出，则销毁对应的进程&#x2F;线程</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">多进程并发模型示例：</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">基于多进程的网络并发模型</span></span><br><span class="line"><span class="string">重点代码 ！！</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">创建tcp套接字</span></span><br><span class="line"><span class="string">等待客户端连接</span></span><br><span class="line"><span class="string">有客户端连接，则创建新的进程具体处理客户端请求</span></span><br><span class="line"><span class="string">父进程继续等待处理其他客户端连接</span></span><br><span class="line"><span class="string">如果客户端退出，则销毁对应的进程</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 地址变量</span></span><br><span class="line">HOST = <span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line">PORT = <span class="number">8888</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理客户端具体请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle</span>(<span class="params">connfd</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = connfd.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(data.decode())</span><br><span class="line">    connfd.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务入口函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 创建tcp套接字</span></span><br><span class="line">    tcp_socket = socket()</span><br><span class="line">    tcp_socket.bind(ADDR)</span><br><span class="line">    tcp_socket.listen(<span class="number">5</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Listen the port %d&quot;</span>%PORT)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 循环连接客户端</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            connfd, addr = tcp_socket.accept()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>, addr)</span><br><span class="line">        <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">            tcp_socket.close()</span><br><span class="line">            sys.exit(<span class="string">&quot;服务结束&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 创建进程 处理客户端请求</span></span><br><span class="line">        p = Process(target=handle, args=(connfd,),daemon=<span class="literal">True</span>)</span><br><span class="line">        p.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">多线程并发模型示例：</span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">基于多线程的网络并发模型</span></span><br><span class="line"><span class="string">重点代码 ！！</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">思路： 网络构建    线程搭建    /   具体处理请求</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理客户端具体请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span>:</span><br><span class="line">    <span class="comment"># 具体处理请求函数 （逻辑处理，数据处理）</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="built_in">print</span>(data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程得到请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ThreadServer</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connfd</span>):</span><br><span class="line">        <span class="variable language_">self</span>.connfd = connfd</span><br><span class="line">        <span class="variable language_">self</span>.handle = Handle()</span><br><span class="line">        <span class="built_in">super</span>().__init__(daemon=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收客户端的请求</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = <span class="variable language_">self</span>.connfd.recv(<span class="number">1024</span>).decode()</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="variable language_">self</span>.handle.request(data)</span><br><span class="line">        <span class="variable language_">self</span>.connfd.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络搭建</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcurrentServer</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    提供网络功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *, host=<span class="string">&quot;&quot;</span>, port=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        <span class="variable language_">self</span>.address = (host, port)</span><br><span class="line">        <span class="variable language_">self</span>.sock = <span class="variable language_">self</span>.__create_socket()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__create_socket</span>(<span class="params">self</span>):</span><br><span class="line">        tcp_socket = socket()</span><br><span class="line">        tcp_socket.bind(<span class="variable language_">self</span>.address)</span><br><span class="line">        <span class="keyword">return</span> tcp_socket</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动服务 --&gt; 准备连接客户端</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serve_forever</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.listen(<span class="number">5</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Listen the port %d&quot;</span> % <span class="variable language_">self</span>.port)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            connfd, addr = <span class="variable language_">self</span>.sock.accept()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>, addr)</span><br><span class="line">            <span class="comment"># 创建线程</span></span><br><span class="line">            t = ThreadServer(connfd)</span><br><span class="line">            t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = ConcurrentServer(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8888</span>)</span><br><span class="line">    server.serve_forever()  <span class="comment"># 启动服务</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>ftp 文件服务器</strong></p>
<p>【1】 分为服务端和客户端，要求可以有多个客户端同时操作。</p>
<p>【2】 客户端可以查看服务器文件库中有什么文件。</p>
<p>【3】 客户端可以从文件库中下载文件到本地。</p>
<p>【4】 客户端可以上传一个本地文件到文件库。</p>
<p>【5】 使用print在客户端打印命令输入提示，引导操作</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line">参考代码：</span><br><span class="line"></span><br><span class="line"><span class="comment">######################### 服务端 ############################</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文件库</span></span><br><span class="line">FTP = <span class="string">&quot;/home/tarena/FTP/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理客户端具体请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connfd</span>):</span><br><span class="line">        <span class="variable language_">self</span>.connfd = connfd</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_list</span>(<span class="params">self</span>):</span><br><span class="line">        filelist = os.listdir(FTP)</span><br><span class="line">        <span class="keyword">if</span> filelist:</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;OK&quot;</span>)</span><br><span class="line">            sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="comment"># 发送文件列表</span></span><br><span class="line">            files = <span class="string">&quot;\n&quot;</span>.join(filelist)</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(files.encode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;FAIL&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_get</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            file = <span class="built_in">open</span>(FTP + filename, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;FAIL&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;OK&quot;</span>)</span><br><span class="line">            sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="comment"># 　发送文件</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                data = file.read(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                <span class="variable language_">self</span>.connfd.send(data)</span><br><span class="line">            file.close()</span><br><span class="line">            sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;##&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_put</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="comment"># 判断文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> os.path.exists(FTP + filename):</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;FAIL&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="variable language_">self</span>.connfd.send(<span class="string">b&quot;OK&quot;</span>)</span><br><span class="line">            <span class="comment"># 接收文件</span></span><br><span class="line">            file = <span class="built_in">open</span>(FTP + filename, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                data = <span class="variable language_">self</span>.connfd.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> data == <span class="string">b&quot;##&quot;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                file.write(data)</span><br><span class="line">            file.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">request</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = <span class="variable language_">self</span>.connfd.recv(<span class="number">1024</span>).decode()</span><br><span class="line">            <span class="comment"># 分情况具体处理请求函数</span></span><br><span class="line">            tmp = data.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data <span class="keyword">or</span> tmp[<span class="number">0</span>] == <span class="string">&quot;EXIT&quot;</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">elif</span> tmp[<span class="number">0</span>] == <span class="string">&quot;LIST&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>.do_list()</span><br><span class="line">            <span class="keyword">elif</span> tmp[<span class="number">0</span>] == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">                <span class="comment"># tmp-&gt; [GET,filename]</span></span><br><span class="line">                <span class="variable language_">self</span>.do_get(tmp[<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">elif</span> tmp[<span class="number">0</span>] == <span class="string">&quot;PUT&quot;</span>:</span><br><span class="line">                <span class="variable language_">self</span>.do_put(tmp[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建线程得到请求</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FTPThread</span>(<span class="title class_ inherited__">Thread</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, connfd</span>):</span><br><span class="line">        <span class="variable language_">self</span>.connfd = connfd</span><br><span class="line">        <span class="variable language_">self</span>.handle = Handle(connfd)</span><br><span class="line">        <span class="built_in">super</span>().__init__(daemon=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 接收客户端的请求</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.handle.request()</span><br><span class="line">        <span class="variable language_">self</span>.connfd.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 网络搭建</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcurrentServer</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    提供网络功能</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *, host=<span class="string">&quot;&quot;</span>, port=<span class="number">0</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.host = host</span><br><span class="line">        <span class="variable language_">self</span>.port = port</span><br><span class="line">        <span class="variable language_">self</span>.address = (host, port)</span><br><span class="line">        <span class="variable language_">self</span>.sock = <span class="variable language_">self</span>.__create_socket()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__create_socket</span>(<span class="params">self</span>):</span><br><span class="line">        tcp_socket = socket()</span><br><span class="line">        tcp_socket.bind(<span class="variable language_">self</span>.address)</span><br><span class="line">        <span class="keyword">return</span> tcp_socket</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 启动服务 --&gt; 准备连接客户端</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">serve_forever</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.listen(<span class="number">5</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Listen the port %d&quot;</span> % <span class="variable language_">self</span>.port)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            connfd, addr = <span class="variable language_">self</span>.sock.accept()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Connect from&quot;</span>, addr)</span><br><span class="line">            <span class="comment"># 创建线程</span></span><br><span class="line">            t = FTPThread(connfd)</span><br><span class="line">            t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    server = ConcurrentServer(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">8880</span>)</span><br><span class="line">    server.serve_forever()  <span class="comment"># 启动服务</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="comment">########################### 客户端 ###############################</span></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">文件服务器客户端</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体发起请求，逻辑处理</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Handle</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.server_address = (<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">8880</span>)</span><br><span class="line">        <span class="variable language_">self</span>.sock = <span class="variable language_">self</span>.__connect_server()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__connect_server</span>(<span class="params">self</span>):</span><br><span class="line">        tcp_socket = socket()</span><br><span class="line">        tcp_socket.connect(<span class="variable language_">self</span>.server_address)</span><br><span class="line">        <span class="keyword">return</span> tcp_socket</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_list</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.send(<span class="string">b&quot;LIST&quot;</span>)  <span class="comment"># 发送请求</span></span><br><span class="line">        response = <span class="variable language_">self</span>.sock.recv(<span class="number">1024</span>)  <span class="comment"># 接收响应</span></span><br><span class="line">        <span class="keyword">if</span> response == <span class="string">b&quot;OK&quot;</span>:</span><br><span class="line">            <span class="comment"># 接收文件列表 file1\nfile2\n..</span></span><br><span class="line">            files = <span class="variable language_">self</span>.sock.recv(<span class="number">1024</span> * <span class="number">1024</span>)</span><br><span class="line">            <span class="built_in">print</span>(files.decode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;获取文件列表失败&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_exit</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.sock.send(<span class="string">b&quot;EXIT&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.sock.close()</span><br><span class="line">        sys.exit(<span class="string">&quot;谢谢使用&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_get</span>(<span class="params">self, filename</span>):</span><br><span class="line">        request = <span class="string">&quot;GET &quot;</span> + filename</span><br><span class="line">        <span class="variable language_">self</span>.sock.send(request.encode())  <span class="comment"># 发送请求</span></span><br><span class="line">        response = <span class="variable language_">self</span>.sock.recv(<span class="number">128</span>)  <span class="comment"># 接收响应</span></span><br><span class="line">        <span class="keyword">if</span> response == <span class="string">b&quot;OK&quot;</span>:</span><br><span class="line">            file = <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">            <span class="comment"># 接收文件内容，写入文件</span></span><br><span class="line">            <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                data = <span class="variable language_">self</span>.sock.recv(<span class="number">1024</span>)</span><br><span class="line">                <span class="keyword">if</span> data == <span class="string">b&quot;##&quot;</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                file.write(data)</span><br><span class="line">            file.close()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该文件不存在&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_put</span>(<span class="params">self, filename</span>):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            file = <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;该文件不存在&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            filename = filename.split(<span class="string">&quot;/&quot;</span>)[-<span class="number">1</span>]  <span class="comment"># 获取文件名</span></span><br><span class="line">            request = <span class="string">&quot;PUT &quot;</span> + filename</span><br><span class="line">            <span class="variable language_">self</span>.sock.send(request.encode())</span><br><span class="line">            response = <span class="variable language_">self</span>.sock.recv(<span class="number">128</span>)</span><br><span class="line">            <span class="keyword">if</span> response == <span class="string">b&quot;OK&quot;</span>:</span><br><span class="line">                <span class="comment"># 发送文件</span></span><br><span class="line">                <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">                    data = file.read(<span class="number">1024</span>)</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="variable language_">self</span>.sock.send(data)</span><br><span class="line">                file.close()</span><br><span class="line">                sleep(<span class="number">0.1</span>)</span><br><span class="line">                <span class="variable language_">self</span>.sock.send(<span class="string">b&quot;##&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;上传失败&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图形交互类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FTPView</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.__handle = Handle()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__display_menu</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;1. 查看文件&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;2. 下载文件&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;3. 上传文件&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;4. 退   出&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__select_menu</span>(<span class="params">self</span>):</span><br><span class="line">        item = <span class="built_in">input</span>(<span class="string">&quot;请输入选项:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> item == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__handle.do_list()</span><br><span class="line">        <span class="keyword">elif</span> item == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">            filename = <span class="built_in">input</span>(<span class="string">&quot;要下载的文件:&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.__handle.do_get(filename)</span><br><span class="line">        <span class="keyword">elif</span> item == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">            filename = <span class="built_in">input</span>(<span class="string">&quot;要上传的文件:&quot;</span>)</span><br><span class="line">            <span class="variable language_">self</span>.__handle.do_put(filename)</span><br><span class="line">        <span class="keyword">elif</span> item == <span class="string">&quot;4&quot;</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__handle.do_exit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;请输入正确选项！&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="variable language_">self</span>.__display_menu()</span><br><span class="line">            <span class="variable language_">self</span>.__select_menu()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ftp = FTPView()</span><br><span class="line">    ftp.main()  <span class="comment"># 启动</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-3-高并发技术探讨"><a href="#4-3-高并发技术探讨" class="headerlink" title="4.3 高并发技术探讨"></a>4.3 高并发技术探讨</h3><ul>
<li><p>衡量高并发的关键指标</p>
<ul>
<li><p>响应时间(Response Time) ： 接收请求后处理的时间</p>
</li>
<li><p>同时在线用户数量：同时连接服务器的用户的数量</p>
</li>
<li><p>每秒查询率QPS(Query Per Second)： 每秒接收请求的次数</p>
</li>
<li><p>每秒事务处理量TPS(Transaction Per Second)：每秒处理请求的次数（包含接收，处理，响应）</p>
</li>
<li><p>吞吐量(Throughput)： 响应时间+QPS+同时在线用户数量</p>
</li>
</ul>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://xurucby.github.io">xuru</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xurucby.github.io/2026/01/13/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">https://xurucby.github.io/2026/01/13/python%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xurucby.github.io" target="_blank">xuru的技术学习博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python</a></div><div class="post-share"><div class="social-share" data-image="/img/butterfly-icon.png" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2026/01/13/git/" title="git"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">git</div></div><div class="info-2"><div class="info-item-1">2. GIT使用2.1 GIT概述 代码管理工具的用途  防止代码丢失，做备份 项目的版本管理和控制，可以通过设置节点进行跳转 建立各自的开发环境分支，互不影响，方便合并 在多终端开发时，方便代码的相互传输   GIT GIT是一个开源的分布式版本控制系统，用于高效的管理各种大小项目和文件。  GIT的特点  git是开源的，多在*nix下使用，可以管理各种文件  git是分布式的项目管理工具(SVN是集中式的)  git数据管理更多样化，分享速度快，数据安全  git 拥有更好的分支支持，方便多人协调     Linux下GIT安装    sudo apt  install  git  2.2 GIT使用  基本概念 工作区：项目所在操作目录，实际操作项目的区域 暂存区: 用于记录工作区的工作（修改）内容 仓库区: 用于备份工作区的内容 远程仓库: 远程主机上的GIT仓库     注意： 在本地仓库中，git总是希望工作区的内容与仓库区保持一致，而且只有仓库区的内容才能和其他远程仓库交互。  2.2.1 初始配置 配置命令： git config –global [选项] 配置...</div></div></div></a><a class="pagination-related" href="/2026/01/13/MySQL/" title="MySQL"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">MySQL</div></div><div class="info-2"><div class="info-item-1">MySQL1. 数据库1.1概述 数据存储   人工管理阶段 缺点 ：  数据存储量有限，共享处理麻烦，操作容易混乱  文件管理阶段 （.txt  .doc  .xls） 优点 ：  数据可以长期保存,可以存储大量的数据,使用简单。 缺点 ：  数据一致性差,数据查找修改不方便,数据冗余度可能比较大。  数据库管理阶段 优点 ： 数据组织结构化降低了冗余度,提高了增删改查的效率,容易扩展,方便程序调用处理 缺点 ： 需要使用sql 或者其他特定的语句，相对比较专业    数据库应用领域 数据库的应用领域几乎涉及到了需要数据管理的方方面面，融机构、游戏网站、购物网站、论坛网站 … …都需要数据库进行数据存储管理。     基本概念 数据库 ： 按照数据一定结构，存储管理数据的仓库。数据库是在数据库管理系统管理和控制下，在一定介质上的数据集合。 数据库管理系统 ：管理数据库的软件，用于建立和维护数据库。    关系型数据库和非关系型数据库  关系型： 采用关系模型（二维表）来组织数据结构的数据库 ，如Oracle 、SQL_Server、 MySQL 非关系型： 不采用关系模型组织数...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2026/01/13/python%E5%AE%B9%E5%99%A8%E5%87%BD%E6%95%B0/" title="python容器函数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-13</div><div class="info-item-2">python容器函数</div></div><div class="info-2"><div class="info-item-1">列表（list）相关方法说明一、查找相关方法   方法 说明    L.index(v [, begin[, end]]) 返回对应元素的索引下标，begin 为开始索引，end 为结束索引；当 value 不存在时触发 ValueError 错误   L.count(x) 用于统计某个元素在列表中出现的次数   L.pop([index]) 删除索引对应的元素，如果不加索引，默认删除最后一个元素，同时返回删除元素的引用关系   二、修改相关方法   方法 说明    L.insert(index, obj) 将某个元素插放到列表中指定的位置   L.extend(lst) 向列表追加另一个列表（将 lst 中的所有元素添加到原列表末尾）   L.remove(x) 从列表中删除第一次出现在列表中的指定值   L.clear() 清空列表，等同于 L[:] = []   L.sort(reverse=False) 将列表中的元素进行排序，默认按值从小到大的顺序排列（reverse&#x3D;True 时按从大到小排序）   L.reverse() 列表反转，改变原列表的先后顺序 ...</div></div></div></a><a class="pagination-related" href="/2026/01/13/python%E9%AB%98%E7%BA%A7/" title="python高级"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-13</div><div class="info-item-2">python高级</div></div><div class="info-2"><div class="info-item-1">1 程序结构1.1 模块 Module1.1.1 定义包含一系列数据、函数、类的文件，通常以.py结尾。 1.1.2 作用 让相关的数据、函数、类有逻辑地组织在一起，使逻辑结构更清晰。 有利于多人合作开发。  1.1.3 导入1.1.3.1 import 语法：12import 模块名import 模块名 as 别名 作用：将模块整体导入到当前模块中 使用：模块名.成员  1.1.3.2 from import 语法：123from 模块名 import 成员名from 模块名 import 成员名 as 别名from 模块名 import * 作用：将模块内的成员导入到当前模块作用域中 使用：直接使用成员名  导入示例代码123456789101112131415161718192021222324252627282930# module01.pydef func01():    print(&quot;module01 - func01执行喽&quot;)def func02():    print(&quot;module01 - func02执行喽&quot;)# 导入方...</div></div></div></a><a class="pagination-related" href="/2026/01/13/python%E6%A0%B8%E5%BF%83/" title="python核心"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-13</div><div class="info-item-2">python核心</div></div><div class="info-2"><div class="info-item-1">2. Python简介2.1 计算机基础结构2.1.1 硬件1944年，美籍匈牙利数学家冯·诺依曼提出计算机基本结构，五大组成部分如下：  运算器：按照程序中的指令，对数据进行加工处理 控制器：根据程序需求，指挥计算机的各个部件协调工作 通常将运算器和控制器集成在中央处理器（CPU）中 存储器：保存各类程序的数据信息 内存RAM：容量小，速度快，临时存储数据 硬盘HDD：容量大，速度慢，永久存储数据   输入设备：外界向计算机传送信息的装置，例如：鼠标、键盘、扫描仪… 输出设备：计算机向外界传送信息的装置，例如：显示器、音响、打印机…  硬件工作流程：外存储器（如程序、原始数据）→输入设备→内存储器→运算器，控制器发出存取指令、运算命令，运算器处理后的数据回存内存储器，再通过输出设备输出信息。 2.1.2 软件软件层级结构：用户→应用软件→操作系统→计算机硬件  操作系统： 管理和控制计算机软件与硬件资源的程序 隔离不同硬件的差异，使软件开发简单化 常见系统：Windows、Linux、Unix   应用软件：为了某种特定的用途而被开发的软件 软件的组成：程序 + 文档 程序：是...</div></div></div></a><a class="pagination-related" href="/2026/01/13/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="python面向对象"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2026-01-13</div><div class="info-item-2">python面向对象</div></div><div class="info-2"><div class="info-item-1">1. 概述1.1 面向过程 定义：分析出解决问题的步骤，然后逐步实现。 示例：婚礼筹办需依次完成请柬准备、宴席安排、仪式策划等步骤。   公式：程序 &#x3D; 算法 + 数据结构 优点：所有环节、细节可自主掌控。 缺点：需考虑全部细节，工作量大。  1.2 面向对象 定义：找出解决问题的相关对象，然后为其分配职责。 示例：婚礼筹办可委托摄影公司负责请柬、酒店负责宴席、婚庆公司负责仪式。   公式：程序 &#x3D; 对象 + 交互 优点： 思想层面：可模拟现实情景，更贴近人类思维，便于梳理和分析问题。 技术层面：高复用（封装重复代码）、高扩展（新增功能不修改旧代码）、高维护（代码逻辑清晰）。   缺点：学习曲线较陡峭。  2. 类和对象 抽象：从具体事物中抽离共性、本质，舍弃个别、非本质特征的过程。 示例：手机的共性数据（品牌、价格、颜色）和行为（通话）。   类：一个抽象的概念，对应生活中的“类别”。 对象：类的具体实例，即归属于某个类别的“个体”。 类是创建对象的“模板”。  2.1 语法2.1.1 定义类 代码：1234567class 类名:    &quot;&qu...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/butterfly-icon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xuru</div><div class="author-info-description">专注技术学习，分享学习之路，博客内容配套Gitee源码</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://gitee.com/xu-ru1" target="_blank" title="gitee"><i class="Gitee"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="toc-number">1.</span> <span class="toc-text">1. 文件读写</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%BC%95%E5%85%A5"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 引入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 文件读写操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E6%89%93%E5%BC%80%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.2.1 打开文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2.2 读取文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">1.2.3 写入文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.4.</span> <span class="toc-text">1.2.4 关闭文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-5-with%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.2.5.</span> <span class="toc-text">1.2.5 with语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-6-%E8%AF%BB%E5%86%99%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">1.2.6.</span> <span class="toc-text">1.2.6 读写缓冲区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-7-%E6%96%87%E4%BB%B6%E5%81%8F%E7%A7%BB%E9%87%8F"><span class="toc-number">1.2.7.</span> <span class="toc-text">1.2.7 文件偏移量</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-os%E6%A8%A1%E5%9D%97"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 os模块</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">2. 网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E8%AE%A4%E7%9F%A5"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 网络基础认知</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E7%BD%91%E7%BB%9C"><span class="toc-number">2.1.1.</span> <span class="toc-text">2.1.1 什么是网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E6%A0%87%E5%87%86"><span class="toc-number">2.1.2.</span> <span class="toc-text">2.1.2 网络通信标准</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-%E9%80%9A%E4%BF%A1%E5%9C%B0%E5%9D%80"><span class="toc-number">2.1.3.</span> <span class="toc-text">2.1.3  通信地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.1.4.</span> <span class="toc-text">2.1.4 服务端与客户端</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-UDP-%E4%BC%A0%E8%BE%93%E6%96%B9%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 UDP 传输方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%A5%97%E6%8E%A5%E5%AD%97%E7%AE%80%E4%BB%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">2.2.1 套接字简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-UDP%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">2.2.2.</span> <span class="toc-text">2.2.2  UDP套接字编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-UDP%E5%A5%97%E6%8E%A5%E5%AD%97%E7%89%B9%E7%82%B9"><span class="toc-number">2.2.3.</span> <span class="toc-text">2.2.3  UDP套接字特点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-TCP-%E4%BC%A0%E8%BE%93%E6%96%B9%E6%B3%95"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 TCP 传输方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-TCP%E4%BC%A0%E8%BE%93%E7%89%B9%E7%82%B9"><span class="toc-number">2.3.1.</span> <span class="toc-text">2.3.1 TCP传输特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-TCP%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-number">2.3.2.</span> <span class="toc-text">2.3.2 TCP服务端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-TCP%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-number">2.3.3.</span> <span class="toc-text">2.3.3 TCP客户端</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-TCP%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BB%86%E8%8A%82"><span class="toc-number">2.3.4.</span> <span class="toc-text">2.3.4 TCP套接字细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-5-TCP%E4%B8%8EUDP%E5%AF%B9%E6%AF%94"><span class="toc-number">2.3.5.</span> <span class="toc-text">2.3.5 TCP与UDP对比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-TCP%E5%8D%8F%E8%AE%AE%E5%92%8CHTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 TCP协议和HTTP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-1-%E4%BC%A0%E8%BE%93%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.1.</span> <span class="toc-text">2.4.1 传输流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-2-TCP%E5%8D%8F%E8%AE%AE%E9%A6%96%E9%83%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">2.4.2.</span> <span class="toc-text">2.4.2 TCP协议首部信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-3-%E7%BD%91%E9%A1%B5%E8%AE%BF%E9%97%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">2.4.3.</span> <span class="toc-text">2.4.3 网页访问流程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-4-HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.4.4.</span> <span class="toc-text">2.4.4 HTTP协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-5-HTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">2.4.5.</span> <span class="toc-text">2.4.5 HTTP请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-6-HTTP%E5%93%8D%E5%BA%94"><span class="toc-number">2.4.6.</span> <span class="toc-text">2.4.6 HTTP响应</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">3. 多任务编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%A4%9A%E4%BB%BB%E5%8A%A1%E6%A6%82%E8%BF%B0"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 多任务概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E8%BF%9B%E7%A8%8B%EF%BC%88Process%EF%BC%89"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 进程（Process）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E8%BF%9B%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 进程概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%BC%96%E7%A8%8B"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 多进程编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E8%BF%9B%E7%A8%8B%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">3.2.3.</span> <span class="toc-text">3.2.3 进程处理细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E5%88%9B%E5%BB%BA%E8%BF%9B%E7%A8%8B%E7%B1%BB"><span class="toc-number">3.2.4.</span> <span class="toc-text">3.2.4 创建进程类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">3.2.5.</span> <span class="toc-text">3.2.5 进程间通信</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%BA%BF%E7%A8%8B-Thread"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 线程 (Thread)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E7%BA%BF%E7%A8%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 线程概述</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 多线程编程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%B1%BB"><span class="toc-number">3.3.3.</span> <span class="toc-text">3.3.3 创建线程类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-4-%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5%E4%BA%92%E6%96%A5"><span class="toc-number">3.3.4.</span> <span class="toc-text">3.3.4 线程同步互斥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-5-%E6%AD%BB%E9%94%81"><span class="toc-number">3.3.5.</span> <span class="toc-text">3.3.5 死锁</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-6-GIL%E9%97%AE%E9%A2%98"><span class="toc-number">3.3.6.</span> <span class="toc-text">3.3.6 GIL问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-7-%E8%BF%9B%E7%A8%8B%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB%E8%81%94%E7%B3%BB"><span class="toc-number">3.3.7.</span> <span class="toc-text">3.3.7 进程线程的区别联系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">4. 网络并发模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%BD%91%E7%BB%9C%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 网络并发模型概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%A4%9A%E8%BF%9B%E7%A8%8B-%E7%BA%BF%E7%A8%8B%E5%B9%B6%E5%8F%91%E6%A8%A1%E5%9E%8B"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 多进程&#x2F;线程并发模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%AB%98%E5%B9%B6%E5%8F%91%E6%8A%80%E6%9C%AF%E6%8E%A2%E8%AE%A8"><span class="toc-number">4.3.</span> <span class="toc-text">4.3 高并发技术探讨</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/13/python%E5%AE%B9%E5%99%A8%E5%87%BD%E6%95%B0/" title="python容器函数">python容器函数</a><time datetime="2026-01-13T03:47:38.000Z" title="发表于 2026-01-13 11:47:38">2026-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/13/python%E9%AB%98%E7%BA%A7/" title="python高级">python高级</a><time datetime="2026-01-13T03:47:16.000Z" title="发表于 2026-01-13 11:47:16">2026-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/13/python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/" title="python面向对象">python面向对象</a><time datetime="2026-01-13T03:47:11.000Z" title="发表于 2026-01-13 11:47:11">2026-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/13/python%E6%A0%B8%E5%BF%83/" title="python核心">python核心</a><time datetime="2026-01-13T03:47:03.000Z" title="发表于 2026-01-13 11:47:03">2026-01-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2026/01/13/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" title="正则表达式">正则表达式</a><time datetime="2026-01-13T03:37:34.000Z" title="发表于 2026-01-13 11:37:34">2026-01-13</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By xuru</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.3</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.3"></script><script src="/js/main.js?v=5.5.3"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>